var TbUtil={addStamp:function(A){return A+(A.indexOf("?")==-1?"?":"&t=")+new Date().getTime().toString(32)},toQueryString:function(B){var C=[];for(var A in B){C.push(encodeURIComponent(A)+"="+encodeURIComponent(B[A]))}return C.join("&")},selectAll:function(G,E,F){var D=document.getElementById(G);if(D){var B=D.getElementsByTagName("input");for(var C=0,A=B.length;C<A;C++){if(B[C].getAttribute("name")==E){B[C].checked=F.checked}}B=null}},getCheckedValue:function(A,G,E){var H=[];E=E||",";var I;var C=document.getElementById(A);if(C){var F=C.getElementsByTagName("input");for(var D=0,B=F.length;D<B;D++){I=F[D];if(I.checked){H.push(I.value)}}F=null}return H.join(E)},G:function(A){return document.getElementById(A)}};TbUtil.trim=function(A){return A.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};TbUtil.DBC2SBC=function(C){var B;var A="";for(B=0;B<C.length;B++){str1=C.charCodeAt(B);if(str1<65296){A+=String.fromCharCode(C.charCodeAt(B));continue}if(str1<125&&!flag){A+=String.fromCharCode(C.charCodeAt(B))}else{A+=String.fromCharCode(C.charCodeAt(B)-65248)}}return A};TbUtil.getByteLength=function(A){return A.replace(/[^\x00-\xff]/g,"mm").length};TbUtil.escapeHTML=function(A){return A.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};TbUtil.escapeUTF8=function(A){return escape(String(A)).replace(/%u(\w{4})/g,function(B,C){return encodeURIComponent(String.fromCharCode("0x"+C)).replace(/%/g,"%25")})};TbUtil.resizePic=function(D,A,J,E){var I=A||120;var F=J||120;var C=false;var G=D;if(G.width==0){var H=this;var L=arguments;setTimeout(function(){L.callee.apply(H,L)},100);return false}function K(M,P,N,R){var O=0,Q=M,S=P;if(M>N){O+=1}if(P>R){O+=2}switch(O){case 1:Q=N;Q=P*N/M;case 2:S=R;Q=M*R/P;case 3:S=(P/R>M/N)?R:P*N/M;Q=(P/R>M/N)?M*R/P:N}if(O!=0){C=true}return[Q,S]}var B=K(G.width,G.height,I,F);D.style.width=B[0]+"px";D.style.height=B[1]+"px";D.style.visibility="visible";if(E==true){D.style.marginTop=(J-parseInt(B[1]))/2+"px"}return C};TbUtil.json={};TbUtil.json.encode=(function(){var B={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function A(F){if(/["\\\x00-\x1f]/.test(F)){F=F.replace(/["\\\x00-\x1f]/g,function(G){var H=B[G];if(H){return H}H=G.charCodeAt();return"\\u00"+Math.floor(H/16).toString(16)+(H%16).toString(16)})}return'"'+F+'"'}function D(K){var G=["["],H=K.length,F,I,J;for(I=0;I<H;I++){J=K[I];switch(typeof J){case"undefined":case"function":case"unknown":break;default:if(F){G.push(",")}G.push(TbUtil.json.encode(J));F=1}}G.push("]");return G.join("")}function C(F){return F<10?"0"+F:F}function E(F){return'"'+F.getFullYear()+"-"+C(F.getMonth()+1)+"-"+C(F.getDate())+"T"+C(F.getHours())+":"+C(F.getMinutes())+":"+C(F.getSeconds())+'"'}return function(J){switch(typeof J){case"undefined":return"undefined";case"number":return isFinite(J)?String(J):"null";case"string":return A(J);case"boolean":return String(J);default:if(J===null){return"null"}else{if(J instanceof Array){return D(J)}else{if(J instanceof Date){return E(J)}else{var G=["{"],I=TbUtil.json.encode,F,H;for(key in J){if(J.hasOwnProperty(key)){H=J[key];switch(typeof H){case"undefined":case"unknown":case"function":break;default:if(F){G.push(",")}F=1;G.push(I(key)+":"+I(H))}}}G.push("}");return G.join("")}}}}}})();TbUtil.json.decode=function(string,secure){if(typeof (string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}try{return eval("("+string+")")}catch(e){return{}}};TbUtil.hiPopHandler=function(A){if(A==0){TbUtil.login()}else{if(A==1||A==3){Fe.Dialog.alertMessageFace("该用户不存在",json._info.replace(/\r?\n/gi,"<br>"),{title:"错误提示",width:350})}}};var PopupDialog={instance:null,open:function(B,A){this.instance=new Popup(A);var C=A.title;if(typeof C=="undefined"){C=""}this.instance.html(B,C);return this.instance},close:function(){if(this.instance){this.instance.reset()}}};var FeDialog={instance:null,open:function(B,A){this.instance=Fe.Dialog.open(B,A);return this.instance},close:function(){Fe.Dialog.close()}};var BaseAjax={get:function(A,B){new Ajax.Request(TbUtil.addStamp(A),{method:"get",parameters:"",onComplete:B})},post:function(A,B,C){new Ajax.Request(A,{method:"post",parameters:B,onComplete:C})},syncGet:function(A,C){var B=Ajax.getTransport();B.open("GET",TbUtil.addStamp(A),false);B.send(null);C(B)}};var FeAjax={get:function(A,B){Fe.Ajax.get(TbUtil.addStamp(A),B)},post:function(A,B,C){Fe.Ajax.post(A,B,C)},syncGet:function(A,B){Fe.Ajax.request(TbUtil.addStamp(A),B,{async:false})}};var TbDialog=null;var is_Fe=("object"==typeof Fe);if(is_Fe&&"undefined"!=typeof Fe.Dialog){TbDialog=FeDialog}else{TbDialog=PopupDialog}var TbAjax=null;if(is_Fe&&"undefined"!=typeof Fe.Ajax){TbAjax=FeAjax}else{TbAjax=BaseAjax}TbAjax.loadjs=function(A){try{var B=document.getElementsByTagName("head").item(0);var C=document.createElement("script");C.setAttribute("src",TbUtil.addStamp(A));C.setAttribute("type","text/javascript");B.appendChild(C);return C}catch(D){}};var TbStatsParams={};var Statistics={addParams:function(B,C){var A=this.getUrl(B,C);_html=B.innerHTML;B.href=A;B.innerHTML=_html},getUrl:function(D,F){var B="";B=D.href;var E=B;var C="";var A=B.indexOf("#");if(A>=0){E=B.slice(0,A);C=B.slice(A)}E+=(E.indexOf("?")==-1?"?":"&");B=E+F+C;return B},sendRequest:function(B){if(document.images){var A=new Image();window["bd_pv_"+(new Date().getTime())]=A;A.src="http://static.tieba.baidu.com/tb/img/pv.gif?"+B+"&t="+new Date().getTime();A=null}},onElementClick:function(E){var E=window.event||E;var D=E.target||E.srcElement;if(D.tagName!="A"&&D.tagName!="INPUT"&&D.tagName!="IMG"){return }var B=this.id;var G=D;var C="";var A="";var F="";while(true){C=G.getAttribute("st_type")||G.getAttribute("cId");if(C){F="area="+C;if(C in TbStatsParams){A=G.getAttribute("st_value");F=TbStatsParams[C]+(A==null?"":("&st_value="+A))}Statistics.sendRequest(F);break}if(G.id==B||G.tagName=="BODY"){break}else{G=G.parentNode}}}};Statistics.init=function(A,D){var C=document.getElementById(A);if(C){if(typeof D=="object"){for(var B in D){TbStatsParams[B]=D[B]}}C.onclick=Statistics.onElementClick}};var Stats=Statistics;var bdPass=bdPass||{};(function(){var baidu={version:"1-0-0",emptyFn:function(){}};baidu.isString=function(a){return(typeof a=="object"&&a&&a.constructor==String)||typeof a=="string"};baidu.sio=baidu.sio||{};baidu.url=baidu.url||{};baidu.string=baidu.string||{};baidu.string.escapeReg=function(a){return String(a).replace(new RegExp("([.*+?^=!:\x24{}()|[\\]/\\\\])","g"),"\\\x241")};baidu.url.parseQuery=function(j,n){if(n){var l=new RegExp("(^|&|\\?|#)"+baidu.string.escapeReg(n)+"=([^&]*)(&|\x24)","");var k=j.match(l);if(k){return k[2]}}else{if(j){j=j.substr(j.indexOf("?")+1,j.length);var g=j.split("&");var h={},e=[],d,c,m;for(var f=0;f<g.length;f++){d=g[f].split("=");c=d[0],m=d[1];if(c===""){continue}if(typeof h[c]=="undefined"){h[c]=m}else{if(baidu.isString(h[c])){continue}else{h[c].push(m)}}}return h}}return null};baidu.sio.get=function(d,a){if(!d||!baidu.isString(d)){return null}var g=baidu.url.parseQuery(d,"callback");var f=document.createElement("SCRIPT");if(!g){var c=false;f.onreadystatechange=f.onload=function(){if(c){return false}if(typeof f.readyState==="undefined"||f.readyState=="loaded"||f.readyState=="complete"){c=true;try{a()}finally{if(f&&f.parentNode){f.parentNode.removeChild(f)}f.onreadystatechange=null;f.onload=null;f=null}}}}else{var b="CB"+Math.floor(Math.random()*2147483648).toString(36);d=d.replace(/(&|\?)callback=([^&]*)/,"\x241callback="+b);window[b]=function(){try{var h=(a||window[g]);h.apply(null,arguments)}finally{if(f&&f.parentNode){f.parentNode.removeChild(f)}f=null;window[b]=null}}}f.src=d;f.type="text/javascript";var e=document.getElementsByTagName("HEAD")[0];e.insertBefore(f,e.firstChild)};if(bdPass.ShellTemplate){return }var shell=function(){var bdTarget,bdConfig,bdType,json;var st;var busyFlag=false;var preUrl="http://passport.baidu.com/api/?";var errorHash={login:{"-1":"no-token"},reg:{"-1":"no-token"},lockmail:{"1":"no-token","2":"need-login","20":"system-error"},lockphone:{"1":"no-token","2":"need-login","20":"system-error"}};var packUrl=function(type,config){var url=[];url.push("tpl="+config.tpl);url.push("callback=getPassJs");return(preUrl+type+"&"+url.join("&"))};var getPassJs=function(v,obj){if(typeof v=="string"){v=eval(v)}json=v;if(errorHash[bdType][json.error_no]){var error_no=errorHash[bdType][json.error_no];switch(error_no){case"need-login":bdConfig.onNotLogin&&bdConfig.onNotLogin();return ;case"no-token":bdConfig.onSystemError&&bdConfig.onSystemError();return ;case"system-error":bdConfig.onSystemError&&bdConfig.onSystemError();break}}var link=json.jslink;baidu.sio.get(link,renderCallback)};var renderCallback=function(){var template=bdType.charAt(0).toUpperCase()+bdType.slice(1)+"Template";bdPass[template]["render"](json,bdTarget,bdConfig);busyFlag=false};var callJson=function(){var url=packUrl(bdType,bdConfig);baidu.sio.get(url,getPassJs)};var init=function(type,target,config){bdType=type,bdTarget=target,bdConfig=config;callJson()};return{render:function(type,target,config){if(!busyFlag){busyFlag=true;clearTimeout(st);init(type,target,config)}else{st=setTimeout(function(){shell.render(type,target,config)},300)}if(!config.tpl){alert("?tpl")}}}}();bdPass.ShellTemplate=shell})();var PassportSign={dialog:null,action_type:"default",focus_tab:"login",jump_url:"",callback:null,action:{},onAfterLogined:null,onAfterRegistered:null,doAfterLogined:function(){Statistics.sendRequest("st_type=login_succeed&fr=tb0");if(this.onAfterLogined){if(this.onAfterLogined()){return }}if(typeof (PassportSign.callback)=="function"){PassportSign.callback();PassportSign.callback=null}else{var A=PassportSign.action_type;if(typeof (PassportSign.action[A])=="function"){PassportSign.action[A]()}else{this.reload()}}},doAfterRegistered:function(){Statistics.sendRequest("st_type=register_succeed&fr=tb0");var C=document.getElementById("PassFormreg");var A=C.username.value;if(typeof A=="undefined"){A=""}RecommendedPerson.setFollowed();var B='<div id="reg_success_tip"><div class="reg_success_tip_title"><p><img src="http://static.tieba.baidu.com/tb/img/passport_reg_check.gif" /><b>'+A+'</b>，恭喜您已经成功完成注册，请尽情享用贴吧！</p></div><p><button onclick="PassportSign.reload();" type="button">确&nbsp;&nbsp;认</button></p><p class="reg_success_tip_info">本页面会在<span style="color:red;font-weight:bold;" id="reg_success_tip_second">5</span>秒后自动关闭，并返回您注册前的页面。</p>';"</div>";document.getElementById("passpost_sign_wrapper").innerHTML=B;document.getElementById("passpost_sign_footer").innerHTML="";if("object"==typeof Fe){PassportSign.dialog.onclose=function(){top.window.location.reload(true)}}else{PassportSign.dialog.setContent("isReloadOnClose",true)}if(this.onAfterRegistered){if(this.onAfterRegistered()){return }}PassportSign.timer=setInterval(function(){var E=document.getElementById("reg_success_tip_second");if(!E){clearInterval(PassportSign.timer);return }var D=parseInt(E.innerHTML);if(D==1){if(PassportSign.timer!=null){clearInterval(PassportSign.timer);TbDialog.close()}}else{E.innerHTML=D-1}},1000)},doBeforeShowDialog:function(){},reload:function(){TbDialog.close();setTimeout(function(){if(PassportSign.jump_url!=""){top.window.location.href=PassportSign.jump_url}else{top.window.location.reload(true)}},200)},showDialog:function(I){var A=I||"login";var G=null;if(I in PassportSign){G=PassportSign[I]["config"]}else{return }var C="";if("class_name" in PassportSign[I]){C=PassportSign[I]["class_name"]}var F=this.action_type;var H=(F in PassportSign.header)?PassportSign.header[F]:"";var D=(F in PassportSign.footer)?PassportSign.footer[F]:"";var B='<div id="passpost_sign" class="'+C+'"><div id="passpost_sign_header">'+H+"</div>"+PassportSign.nav.buildHtml(I)+'<div id="passpost_sign_wrapper"><div id="passpost_sign_before_cnt"></div><div id="passpost_sign_cnt"></div><div id="passpost_sign_after_cnt"></div></div><div id="passpost_sign_footer">'+D+"</div>";var E=document.getElementById("passpost_sign");if(E){E.innerHTML=""}TbDialog.close();this.dialog=TbDialog.open(B,G);PassportSign[I].buildHtml()},init:function(B,D,G,E){var C=D||"default";var F=B||"login";var A=G||null;this.action_type=C;this.focus_tab=F;this.callback=A;this.showDialog(F);if(E&&E.onAfterLogined){this.onAfterLogined=E.onAfterLogined}else{this.onAfterLogined=function(){return false}}if(E&&E.onAfterRegistered){this.onAfterRegistered=E.onAfterRegistered}else{this.onAfterRegistered=function(){return false}}},setConfig:function(A){}};PassportSign.header={example:"<p>this is the header</p>"};PassportSign.footer={example:"<p>this is the header</p>"};PassportSign.nav={buildHtml:function(F){var E=F||"login";var B={login:["登录",""],register:["注册",""]};var D=['<div id="passpost_sign_nav"><ul>'];var A="";for(var C in B){if(C==F){A='<li class="focus">'+B[C][0]+"</li>"}else{A='<li><div><a href="#" onclick="PassportSign.nav.changeTab(\''+C+"');return false;\">"+B[C][0]+"</a></div></li>"}D.push(A)}D.push('</ul><div class="passpost_sign_nav_line"></div></div>');return D.join("")},changeTab:function(A){PassportSign.focus_tab=A;PassportSign.showDialog(A)}};PassportSign.login={class_name:"passport_sign_login",config:{width:370,height:304,title:"您尚未登录",position:"center"},buildHtml:function(){Statistics.sendRequest("st_type=login_start&fr=tb0");document.getElementById("passpost_sign_before_cnt").innerHTML='<h2 class="passport_login_title">百度注册用户请直接登录</h2>';bdPass.ShellTemplate.render("login","passpost_sign_cnt",{tpl:"tb",tokenUrl:"",jumpUrl:"http://tieba.baidu.com/tb/pass_jump.html",labelName:{username:"用户名：",password:"密&nbsp;&nbsp;码：",verifycode:"验证码："},onAfterRender:function(){PassportSign.login.buildRegisterEntry()},onSuccess:function(){PassportSign.doAfterLogined()}})},buildRegisterEntry:function(){var A='<div class="passport_reg_entry">没有百度账号？&nbsp;<b><a href="#" onclick="PassportSign.nav.changeTab(\'register\');return false;">立即注册百度账号</a></b></div>';document.getElementById("passpost_sign_footer").innerHTML=A;document.getElementById("passpost_sign_before_cnt").innerHTML='<h2 class="passport_login_title">百度注册用户请直接登录</h2>'}};PassportSign.register={class_name:"passport_sign_reg",config:{width:530,height:510,title:"用户注册",position:"center"},buildHtml:function(){Statistics.sendRequest("st_type=register_start&fr=tb0");bdPass.ShellTemplate.render("reg","passpost_sign_cnt",{tpl:"tb",tokenUrl:"",jumpUrl:"http://tieba.baidu.com/tb/pass_jump.html",labelName:{username:"用&nbsp;户&nbsp;名：&nbsp;",loginpass:"设置密码：&nbsp;",verifypass:"确认密码：&nbsp;",sex:"性&nbsp;&nbsp;&nbsp;&nbsp;别：&nbsp;",email:"电子邮件：&nbsp;",verifycode:"验&nbsp;证&nbsp;码：&nbsp;"},buttonValue:"立即注册",onAfterRender:function(){PassportSign.register.buildRecommended();var B=document.getElementById("passpost_sign_after_cnt");var A='<span class="reg_protocal_tip">点击“立即注册”表示您同意并遵守<a href="http://passport.baidu.com/protocal.html" target="_blank">百度用户协议</a></span>';B.innerHTML=A;B.className="reg_protocal";var C=document.getElementById("PassRegAgree");C.parentNode.style.display="none"},onSuccess:function(B,A){PassportSign.doAfterRegistered()}})},buildRecommended:function(){var A='<div id="reg_recommended"><h2>推荐关注名人</h2><div class="reg_recommended_wrapper"><div class="reg_recommended_title"><p style="float:right">您可以选择或取消您要关注的名人</p><p><label><input type="checkbox" style="margin-top:-1px;" checked="checked" onclick="TbUtil.selectAll(\'reg_recommended_cnt\',\'recommended_user\',this);">全选</label></p></div><div id="reg_recommended_cnt"></div></div></div>';document.getElementById("passpost_sign_footer").innerHTML=A;RecommendedPerson.buildHtml()},showSuccessTip:function(){}};var RecommendedPerson={follow_ids:"",buildHtml:function(){var _url="/i/sys/data_recommended?dtype=json&ie=utf-8";TbAjax.get(_url,function(xhr){function buildUser(user,is_checked){var itieba_url="/i/"+user.name_link;var _html='<p class="reg_face_link"><a href="'+itieba_url+'" target="_blank"><img src="http://tb.himg.baidu.com/sys/portrait/item/'+user.itieba_portrait+'" onload="TbUtil.resizePic(this,50,50,true);" /></a></p><p class="reg_name_link"><input type="checkbox"'+(is_checked?' checked="checked"':"")+' name="recommended_user" value="'+user.portrait+'" /><a href="'+itieba_url+'" target="_blank">'+user.name_show+"</a>"+(user.is_verify?'<img src="http://static.tieba.baidu.com/tb/static-itieba/img/itieba_vip.gif" />':"")+"</p>";return _html}var data=eval("("+xhr.responseText+")");var _html=["<table><tr>"];for(var i=0,len=data.length;i<len;i++){_html.push("<td>"+buildUser(data[i],true)+"</td>");if((i+1)%4==0&&i!=len-1){_html.push("</tr><tr>")}}_html.push("</tr></table>");document.getElementById("reg_recommended_cnt").innerHTML=_html.join("")})},setFollowed:function(){var _tbs_url="/i/sys/user_json";this.follow_ids=TbUtil.getCheckedValue("reg_recommended_cnt","recommended_user",",");TbAjax.get(_tbs_url,function(xhr){var data=eval("("+xhr.responseText+")");if(!data.tbs){return }var _url="/i/commit";var _tbs_url="/i/sys/user_json";var _data={cmd:"follow_all",tbs:data.tbs};_data.portraits=RecommendedPerson.follow_ids;TbAjax.post(_url,TbUtil.toQueryString(_data),function(xhr){})})}};TbUtil.login=function(B,C,A){PassportSign.init("login",B,C,A)};TbUtil.register=function(B,C,A){PassportSign.init("register",B,C,A)};var TryGoOther={_keyValues:[["贴吧投诉","http://tieba.baidu.com/tousu/new"],["帖吧投诉","http://tieba.baidu.com/tousu/new"],["tiebatousu","http://tieba.baidu.com/tousu/new"],["知道投诉","http://tousu.baidu.com/zhidao"],["空间投诉","http://tousu.baidu.com/hi"],["百科投诉","http://tousu.baidu.com/baike"],["zhidaotousu","http://tousu.baidu.com/zhidao"],["kongjiantousu","http://tousu.baidu.com/hi"],["baiketousu","http://tousu.baidu.com/baike"]],go:function(E){var A=this._keyValues;var B=E.toLowerCase();for(var C=0;C<A.length;C++){if(B==A[C][0]){window.location.href=A[C][1];return }}var D=TbUtil.DBC2SBC(E);if(/^\d{7,10}$/.test(D)){window.location.href="/club/"+D;return }window.location.href="/f?kw="+encodeURIComponent(D)+"&fr=tb0_search&ie=utf-8"}};var ForHeader={escapeUTF8:function(A){return escape(String(A)).replace(/%u(\w{4})/g,function(B,C){return encodeURIComponent(String.fromCharCode("0x"+C)).replace(/%/g,"%25")})},countPV:function(B){var A=new Image();window["bd_pv_"+(new Date().getTime())]=A;A.src="http://static.tieba.baidu.com/tb/img/pv.gif?t="+new Date().getTime()+"&"+B},trim:function(A){return A.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},setWord:function(F,D){var C=this.trim(document.f1.word.value);if(this.isFristPage("http://tieba.baidu.com")){var E=F.href.indexOf("baidu.com/")+"baidu.com/".length;F.href=F.href.substring(0,E)+"?t=50&q="+encodeURIComponent(C)}else{if(D!=""){if(F.href.indexOf("www.baidu.com")>=0){var A="fr=tb01000&";if(window.location.href.match("ftype=guide")){A="fr=tb01se0&"}var B=F.href.indexOf("fr=");if(B>-1){F.href=F.href.substring(0,B)+A}else{F.href=F.href+A}}C=C.replace(/\%/gi,"%25").replace(/&/gi,"%26").replace(/\+/gi,"%2B").replace(/[\ \u3000]/gi,"%20").replace(/\//gi,"%2F").replace(/\#/gi,"%23").replace(/\=/gi,"%3D");var B=F.href.indexOf(D+"=");if(B>-1){F.href=F.href.substring(0,B)+D+"="+C}else{F.href=F.href+D+"="+C}}}},isFristPage:function(C){var A=window.location.href;var D=C.substring(C.indexOf("//")+2);var B=A.substring(A.indexOf("//")+2);if(B==D||B==D+"/"||B.indexOf(D+"/?")==0||B.indexOf(D+"/#")==0){return true}return false},setVal:function(A,B){A.tn.value=B.tn;A.ct.value=B.ct;A.lm.value=B.lm;A.rn.value=B.rn;A.kw.value=B.kw;A.rs2.value=B.rs2;if(B.pn!=null){A.pn.value=B.pn}if(B.cm!=null){A.cm.value=B.cm}},isSelected:function(B){var A=document.getElementById(B);return A&&A.checked},DBC2SBC:function(A){return TbUtil.DBC2SBC(A)},search:function(D,B){if(!B){B=""}var A=this.trim(D.word.value);if(A==""){D.word.value="";D.word.focus();return false}var C="/f";if(D.un){D.un.value=""}if(D.rs1){D.rs1.value=""}if(D.rs5){D.rs5.value=""}if(D.sn){D.sn.value=""}if(D.rs6){D.rs6.value=""}if(this.isSelected("jointb"+B)){var E=this.trim(D.word.value);TryGoOther.go(E);return false}if(this.isSelected("authortb"+B)){window.location.href="/i/sys/enter?ie=utf-8&kw="+encodeURIComponent(D.word.value);return false}if(this.isSelected("searchtb"+B)){this.setVal(D,{tn:"baiduPostSearch",ct:"352321536",kw:"",rn:"10",lm:"65536",pn:null,cm:null,rs2:"1"})}if(this.isSelected("nametb"+B)){this.setVal(D,{tn:"searchPostListByName",ct:"536870912",kw:"",rn:"30",lm:null,pn:null,cm:"1104",rs2:"3"})}D.action=C;return true}};var UserBar={focus_tab:"",tabs:["forum","club","space"],product:"forum",user_info:null,is_uinfo_requested:false,data_source:{},requestData:function(B){if(UserBar.data_source[B].requested){return }UserBar.data_source[B].requested=true;var C="";var A="";if(UserBar.data_source[B].same_domain==false){UserBar.data_source[B].getData()}else{A=UserBar.data_source[B].url;this._ajaxRequest(A,B)}},showCotent:function(A){this.focus_tab=A;var B=document.getElementById(A+"_info");if(B.style.display=="none"){B.style.display="block"}this.requestData(A)},hideAll:function(){var B=UserBar.tabs;var D;this.focus_tab="";for(var C=0,A=B.length;C<A;C++){D=document.getElementById("my_"+B[C]+"_info");if(D){D.style.display="none"}}},setItiebaId:function(A){this.user_info.itieba_id=A}};UserBar.init=function(A,B){this.product=B||"forum";this.user_info=A;UserBar._render();if(A.is_login){if(document.attachEvent){document.attachEvent("onclick",function(){UserBar.hideAll()});window.attachEvent("onload",function(){UserBar.initSpaceUser();UserBar.initWebIM()})}else{document.addEventListener("click",function(){UserBar.hideAll()},false);window.addEventListener("load",function(){UserBar.initSpaceUser();UserBar.initWebIM()},false)}}else{WealthSystem.UserBarGuide.showSignInTip()}};UserBar._ajaxRequest=function(url,type){TbAjax.get(url+"&t="+Math.random(),function(xmlHttp){try{var rst=eval("("+xmlHttp.responseText+")");UserBar.data_source[type].build(rst)}catch(e){}})};UserBar._getUserInfo=function(){if(UserBar.is_uinfo_requested==true){return }var url="/f?ct=486539264&cm=59202&tn=jsonUserInfo&t="+Math.random();TbAjax.syncGet(url,function(xhr){try{var data=eval("("+xhr.responseText+")");if(data.is_login){UserBar.user_info.name_url=data.user_name_url;UserBar.user_info.portrait=data.user_portrait;UserBar.user_info.has_space=data.user_open_space;UserBar.feedNumNew=data.feedNumNew}}catch(e){}});UserBar.is_uinfo_requested=true};UserBar.data_source.my_forum={requested:false,url:"/f?ct=486539264&cm=80001&tn=jsonMyForum",same_domain:true,build:function(E){var D="";var B=[];if(E.showForum){B=E.showForum_u||E.showForum}var A=B.length;if(A>0){D+='<div style="padding-left:6px;padding-top:2px;">加入的贴吧：</div>';D+="<ul>";for(var C=0;C<A;C++){D+='<li><a href="/f?kw='+B[C][0]+'&from=loginbar" target="_blank">'+B[C][1]+"</a></li>"}D+="</ul>";D+='<div class="more"><a href="/i/sys/jump?type=myforum" target="_blank">查看全部&gt;&gt;</a></div>'}else{D+='<div class="text_cnt">加入您喜欢的贴吧，吧名会在此显示。</div>'}document.getElementById("my_forum_entry").innerHTML=D}};UserBar.data_source.my_club={requested:false,url:"/club/common/getuserclub?",same_domain:true,build:function(D){var C="";if(D==""||!D.clubs){return }var A=D.clubs.length;if(A>0){C="<ul>";for(var B=0;B<A;B++){C+='<li><a href="/club/'+D.clubs[B].id+'/t?from=loginbar" target="_blank">'+TbUtil.escapeHTML(D.clubs[B].name)+"</a></li>"}C+="</ul>";if(D.join_num>6){C+='<div class="more"><a href="/i/sys/jump?type=myclub" target="_blank" style="text-align:right;">查看全部&gt;&gt;</a></div>'}}else{C+='<div class="text_cnt">您还没加入任何俱乐部，快去<a href="/club/dir" class="inline" target="_blank">俱乐部目录</a>逛逛！</div></div>'}if(D.create_num>0){C+='<div style="margin:5px 6px 0 6px;padding:2px 0 2px 0; border-top:1px solid #ccc">爱谈论什么，您可以<a href="/club/common/newclub?from=ucenter" target="_blank" style="padding-right:0;">创建一个俱乐部&gt;&gt;</a></div>'}document.getElementById("my_club_entry").innerHTML=C}};UserBar.data_source.my_space={requested:false,url:"",same_domain:false,getData:function(){var A="http://hi.baidu.com/sys/checkuser/"+UserBar.user_info.name_url;var B='<ul>	<li><a href="sp_home/3?from=tieba" target="_blank" st_value="home" onclick="spaceStats(this);"><b>主页</b></a>|<a href="sp_home/modify/spmodules/0?from=tieba" target="_blank" st_value="spmodules" onclick="spaceStats(this);">空间装扮</a></li>	<li><a href="sp_home/blog/?from=tieba" target="_blank" st_value="blog" onclick="spaceStats(this);"><b>博客</b></a>|<a href="sp_home/creat/blog/?from=tieba" target="_blank" st_value="add_article" onclick="spaceStats(this);">写新文章</a></li>	<li><a href="sp_home/album?from=tieba" target="_blank" st_value="album" onclick="spaceStats(this);"><b>相册</b></a>|<a href="sp_home/albumcreate/picture/album?from=tieba" target="_blank" st_value="add_pic" onclick="spaceStats(this);">上传照片</a></li>	<li><a href="sp_home/friends?from=tieba" target="_blank" st_value="friends" onclick="spaceStats(this);"><b>好友</b></a>|<a href="http://hi.baidu.com/sys/uquery/?from=tieba" target="_blank" st_value="find_friend" onclick="spaceStats(this);">找新朋友</a></li>	<li><a href="sp_home/profile?from=tieba" target="_blank" st_value="profile" onclick="spaceStats(this);"><b>档案</b></a>|<a href="sp_home/board?from=tieba" target="_blank" st_value="board" onclick="spaceStats(this);">留言板</a></li></ul>';document.getElementById("my_space_entry").innerHTML=B.replace(/sp_home/g,A)}};function spaceStats(B){var A=B.getAttribute("st_value");Statistics.sendRequest("st_type=space&st_value="+A+"&st_mod=userbar&fr=tb0_forum")}UserBar.feedNumNew=-1;UserBar._render=function(){var C=false;var H="";if(UserBar.user_info.is_login){H='<a href="/i/sys/jump?type=guess" target="_blank">我要参加&gt;&gt;</a>'}else{H='<a href="#" onclick="TbUtil.login();return false;">我要参加&gt;&gt;</a>'}var D='<div id="userbar_sign_in_guide" style="background:none;"></div>';if(C){D='<div id="userbar_sign_in_guide" class="'+(UserBar.user_info.is_login?"userbar_sign_in_guide_online":"userbar_sign_in_guide_offline")+'" style="display:none;background-position:0 -220px;width:252px;"><div class="userbar_sign_in_guide_cnt"><div><a href="" class="userbar_sign_in_guide_close" onclick="WealthSystem.UserBarGuide.closeSignInTip();return false;" title="关闭" alt="关闭"> </a><p style="float:left;">世界杯竞猜上线啦！</p><p style="clear:both;">'+H+"</p></div></div></div>"}var G='<ul id="tb_userbar" class="userbar_nav"><li><a href="#" onclick="TbUtil.register();return false;">注册</a></li><li class="split">|</li><li id="sign_in_guide_li" class="userbar_tab_wrap"><a href="#" onclick="TbUtil.login();return false;">登录</a>'+D+"</li></ul>";function F(){var K=UserBar.user_info;var O="openIM('active','"+K.name+"','',{});";var P="http://passport.baidu.com/?logout&aid=6&sid="+K.sid.slice(0,64)+"&u="+TbUtil.escapeUTF8(window.location.href);var R,N,T,L;var Q="st_mod=userbar&fr=tb0_"+UserBar.product;if(K.itieba_id>0){R="/i/"+K.itieba_id;Q="?"+Q;N=R+Q;T=R+"/club"+Q;L="/"}else{R="/i/sys/jump?&un="+K.name_url;Q="&"+Q;N=R+Q;T=R+"&type=myclub"+Q;L="&type="}var J={my_forum:{link:'<a href="'+N+'" class="arrow">我的<span class="itb_i_small">i</span>贴吧<span class="feedNumNew"></span></a>'},my_club:{link:'<a href="'+T+'" class="arrow">我的俱乐部</a>'},my_space:{link:'<a href="http://hi.baidu.com/sys/checkuser/'+K.name_url+'/space?from=tieba" class="arrow" target="_blank">我的空间</a>'}};function S(V,W){var U='<div class="userbar_tab_title" id="'+V+'" onmouseover="UserBar.showCotent(\''+V+"');\">"+W+'</div><div id="'+V+'_info" class="userbar_tab_body" style="display:none;" onmouseover="UserBar.showCotent(\''+V+'\');" onmouseout="UserBar.hideAll();">	<div class="userbar_tab_body_title">'+W+'</div>	<div class="userbar_tab_body_cnt"><div id="'+V+'_entry"></div></div></div>';return U}var M='<ul id="tb_userbar" class="userbar_nav"><li class="username"><a href="http://passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0"><strong>'+K.name+'</strong></a></li><li id="hiIcon" title="发起即时会话" onclick="'+O+'"></li><li id="hiMsg" onclick="'+O+'"><div id="msgRight">0</div></li><li class="split">|</li><li class="bd_msg"><a href="http://msg.baidu.com/" target="_blank">消息<span id="userbar_msg_num"></span></a></li><li class="split">|</li><li id="my_forum_wrap" class="userbar_tab_wrap">	<div class="userbar_tab_title" id="my_forum" onmouseover="UserBar.showCotent(\'my_forum\')">'+J.my_forum.link+'</div>	<div id="tb_message_tip" style="display:none;"><div class="top"></div><div id="tb_message_tip_cnt"></div></div>'+(C?"":D)+'	<div id="my_forum_info" class="userbar_tab_body" style="display:none;" onmouseover="UserBar.showCotent(\'my_forum\')" onmouseout="UserBar.hideAll();">	<div class="userbar_tab_body_title">'+J.my_forum.link+'</div>	<div class="userbar_tab_body_cnt">	<div id="itieba_entry"><ul>		<li><a href="'+R+L+Q+'">全部动态</a></li>		<li><a href="'+R+L+"ifeed"+Q+'"><span class="itb_i_small">i</span>动态</a></li>		<li><a href="'+R+L+"one"+Q+'">我的动态</a></li>		</ul>	</div>	<div class="userbar_tab_body_divide"></div>	<div id="my_forum_entry"></div>	</div></div></li><li class="split">|</li><li id="my_club_wrap" class="userbar_tab_wrap">'+S("my_club",J.my_club.link)+'</li><li class="split">|</li><li id="my_space_wrap" style="display:none;" class="userbar_tab_wrap">'+S("my_space",J.my_space.link)+'</li><li class="split" id="my_space_split">|</li><li id="sign_in_guide_li" class="userbar_tab_wrap"><a href="'+P+'" onclick="UserBar.signOut();return false;">退出</a>'+(C?D:"")+"</li></ul>";return M}function E(){if(typeof userbar_feednum_hide!="undefined"&&userbar_feednum_hide){return }if(UserBar.feedNumNew==-1){setTimeout(E,30);return }if(UserBar.feedNumNew==0){return }var L=UserBar.feedNumNew>100?"100+":UserBar.feedNumNew;var K=document.getElementById("my_forum_wrap").getElementsByTagName("span");for(var M=0,J=K.length;M<J;M++){var N=K[M];if(N.className=="feedNumNew"){N.innerHTML='(<span style="color:red;">'+L+"</span>)"}}}var B="";if(UserBar.user_info.is_login){B=F();var A="";if(typeof UserBar.user_info.portrait!="undefined"){A=UserBar.user_info.portrait}Stats.sendRequest("st_type=login_user&st_mod=userbar&fr=tb0_"+UserBar.product+"&st_value="+UserBar.user_info.name_url+"&u="+A)}else{B=G}var I=document.getElementById("userbar");if(I){I.innerHTML=B;I.onmouseout=function(){UserBar.hideAll()};if(UserBar.user_info.is_login){E()}}};UserBar.PdcData={_url:"http://pdc.baidu.com/imstate?type=json&flag=4103",_portrait:"",request:function(B){if(B==""){return }this._portrait=B;var A=this._url+"&callback=UserBar.PdcData.handle&uids="+B+"&t="+new Date().getTime().toString(32);TbAjax.loadjs(A)},handle:function(B){var C=B[this._portrait];if(typeof C=="undefined"){return }var A=false;if("space" in C&&C.space=="1"){A=true}UserBar._showSpaceInfo(A)}};UserBar._showSpaceInfo=function(A){var D=document.getElementById("my_space_wrap");var C=document.getElementById("my_space_split");if(A){D.style.display="block";C.style.display="block"}else{var B='<a href="http://hi.baidu.com/sys/reg?from=tieba" target="_blank">激活空间</a>';D.innerHTML=B;D.style.display="block"}WealthSystem.UserBarGuide.showSignInTip()};UserBar.initSpaceUser=function(){var A=UserBar.user_info;if("has_space" in A){UserBar._showSpaceInfo(A.has_space)}else{UserBar._getUserInfo();UserBar._showSpaceInfo(A.has_space)}};UserBar.showMsg=function(A){if(typeof (A)=="number"){if(A>0){document.getElementById("userbar_msg_num").innerHTML='(<span style="color:red">'+A+"</span>)"}}};UserBar.initWebIM=function(){webHi.textBlock=document.getElementById("hiIcon");webHi.textTip=document.getElementById("hiMsg");if(!(UserBar.user_info.is_verfiy==true)){var B=UserBar.user_info.id;if(typeof (B)=="undefined"){return }if(typeof (B)!=="string"){B=B.toString()}var A=B.length;if(B.substring(A-2,A)>=25){startShowHiMsg(UserBar.user_info.name)}}};UserBar.signOut=function(){var A=window.sign_out_timer;if(typeof A=="undefined"){window.sign_out_timer=setTimeout(function(){var B="http://passport.baidu.com/?logout&aid=6&sid="+UserBar.user_info.sid.slice(0,64)+"&u="+TbUtil.escapeUTF8(window.location.href);window.location.href=B},1500);WealthSystem.UserBarGuide.showSignOutTip()}};window.baidu=window.baidu||{version:"1-0-0",emptyFn:function(){}};baidu.swf=baidu.swf||{};baidu.isString=function(A){return(typeof A=="object"&&A&&A.constructor==String)||typeof A=="string"};baidu.swf.getVersion=function(){var E=navigator;if(E.plugins&&E.mimeTypes.length){var A=E.plugins["Shockwave Flash"];if(A&&A.description){return A.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}}else{if(window.ActiveXObject&&!window.opera){for(var B=10;B>=2;B--){try{var D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+B);if(D){return B+".0.0";break}}catch(C){}}}}};baidu.swf.createHTML=function(P){P=P||{};var H=baidu.swf.getVersion(),O=1;var F=P.ver||"6.0.0",E,C;if(H){H=H.split(".");F=F.split(".");for(var D=0;D<3;D++){E=parseInt(H[D],10);C=parseInt(F[D],10);if(C<E){break}else{if(C>E){O=0;break}}}}else{O=0}if(!O){return""}var J=P.vars;var D,B,G,N;var I=["classid","codebase","id","width","height","align"];P.align=P.align||"middle";P.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000";P.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0";P.movie=P.url||"";delete P.vars;delete P.url;if(baidu.isString(J)){P.flashvars=J}else{var L=[];for(B in J){N=J[B];if(N){L.push(B+"="+encodeURIComponent(N))}}P.flashvars=L.join("&")}var K=["<object "];for(D=0,G=I.length;D<G;D++){N=I[D];K.push(" ",N,'="',P[N],'"')}K.push(">");var A={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(B in P){N=P[B];if(A[B]&&N){K.push('<param name="'+B+'" value="'+N+'" />')}}P.src=P.movie;P.name=P.id;delete P.id;delete P.movie;delete P.classid;delete P.codebase;P.type="application/x-shockwave-flash";P.pluginspage="http://www.macromedia.com/go/getflashplayer";K.push("<embed");var M;for(B in P){N=P[B];if(N){if((new RegExp("^salign\x24","i")).test(B)){M=N;continue}K.push(" ",B,'="',N,'"')}}if(M){K.push(' salign="',M,'"')}K.push("></embed></object>");return K.join("")};baidu.swf.create=function(A,D){A=A||{};var B=baidu.swf.createHTML(A);var C=true;if(D&&baidu.isString(D)){D=document.getElementById(D)}if(B.length<=0){B=A.errorMessage||"";C=false}if(D){D.innerHTML=B}else{document.write(B)}return C};baidu.swf.getMovie=function(A){return document[A]||window[A]};var LCF=(function(){var F=(new Date()).getTime();var P="lc_"+F;var N="http://static.tieba.baidu.com/tb/js/lib/local_2010062103.swf?v="+F;var J=["onMessage=__ITIEBA__onmsg"];function K(){return['<object id="',P,'" name="',P,'"  type="application/x-shockwave-flash" data="',N,'" width="1" height="1" style="-moz-user-focus: ignore;">','<param name="movie" value="',N,'" />','<param name="bgcolor" value="#fff" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+J.join("&amp;")+'" />',"</object>"].join("")}function I(U){return baidu.swf.getMovie(U)}function O(){baidu.swf.create({id:P,width:"1",height:"1",ver:"9.0.0",errorMessage:"",url:N,bgcolor:"#FFFFFF",wmode:"opaque",allowscriptaccess:"always",vars:J.join("&amp;")},"local_flash_cnt")}function S(U,X,W){window.__ITIEBA__onmsg=X||function(){};if(U){W.userName=U}for(var V in W){J[J.length]=V+"="+W[V]}O()}function R(V){var U=I(P);if(U&&U.get){return U.get(V)}return null}function H(){var U=I(P);if(U&&U.getAll){return U.getAll()}return{}}function D(V,W){var U=I(P);if(U&&U.set){U.set(V,W);return true}return false}function E(V,W){var U=I(P);if(U&&U.setOwn){U.setOwn(V,W);return true}return false}function L(V,W){var U=I(P);if(U&&U.setOther){U.setOther(V,W);return true}return false}function Q(V){var U=I(P);if(U&&U.remove){U.remove(V);return true}return false}function A(){var U=I(P);if(U&&U.removeAll){U.removeAll();return true}return false}function G(U,W){var V=I(P);if(V&&V.request){V.request(U,W);return true}return false}function M(V,U,X,Y){var W=I(P);if(W&&W.listen){return W.listen(V,U,X,Y)}return false}function T(V){var U=I(P);if(U&&U.stoplisten){U.stoplisten(V);return true}return false}function B(){var U=I(P);if(U&&U.closeServer){U.closeServer();return true}return false}function C(){var U=I(P);if(U&&U.openServer){U.openServer();return true}return false}return{set:D,setOther:L,setOwn:E,get:R,getAll:H,init:S,remove:Q,removeAll:A,request:G,listen:M,stopListen:T,closeServer:B,openServer:C}})();var itieba_msg_debug_mode=false;var ONLINE_LISTEN_TIME=300*1000;var MSG_SYS_MXA_LOOP_NUM=180*4;var MSG_SYS_LOOP_INTERVAL=250;var MsgSystem={need_start:true,is_server:false,product:"forum",itb_home:"",display_types:["evaluate","fans","feature","reply","guess"],sys_msg_types:[],link_taget:"_self",SYS_MSG_CONF:{all_msg:{id:0,display:true,aside_tip_id:"",url:""},fans:{id:1,url:"#itb_home#&type=fans",aside_tip_id:"",display:true},evaluate:{id:2,url:"#itb_home#&type=my_evaluate",aside_tip_id:"new_evaluate_num_tip",display:true},wealth:{id:3,url:"",display:true},reply:{id:4,url:"#itb_home#&type=replyme",aside_tip_id:"new_reply_num_tip",display:true},feature:{id:5,url:"#itb_home#&type=feature",aside_tip_id:"new_feature_num_tip",display:true},guess:{id:6,url:"#itb_home#&type=guess",aside_tip_id:"new_guess_num_tip",display:true}},CHAT_MSG_CONF:{command_listen:{id:"listen"},command_connected:{id:"sysconn_0"},command_disconnect:{id:"sysconn_1"},chat_msg:{id:"chat_msg"},sys_msg:{id:"sys_msg"},command_chatting:{id:"chatting"}},chat_msg_types:{},itb_home:"",user:null,init:function(G,A){MsgSystem.product=G;MsgSystem.itb_home="/i/sys/jump?u="+A.portrait;if(G!="itieba"){MsgSystem.link_taget="_blank"}this.user=A;var E=this.display_types;var I=document.getElementById("tb_message_tip_cnt");var B=[];B.push("<ul>");for(var D=0,C=E.length;D<C;D++){B.push('<li id="message_'+E[D]+'" style="display:none;"></li>')}B.push("</ul>");B.push('<div class="tb_msg_tip_rightpanel">');B.push('<a href="'+MsgSystem.itb_home+'&type=profile" target="_self" class="setting">设置</a>');B.push('<a title="关闭" href="#" onclick="MsgLoader.clearAllData();return false" class="close_msg_tip"></a>');B.push('<b style="clear:both;"></b>');B.push("</div>");I.innerHTML=B.join("");MsgHandler.tip_ele=document.getElementById("tb_message_tip");Blinker.real_title=document.title;var H;for(var F in this.SYS_MSG_CONF){H=this.SYS_MSG_CONF[F];this.sys_msg_types[H.id]=F;if(typeof H.url!="undefined"){this.SYS_MSG_CONF[F]["url"]=H.url.replace(/#itb_home#/g,MsgSystem.itb_home)}}for(var F in this.CHAT_MSG_CONF){H=this.CHAT_MSG_CONF[F];this.chat_msg_types[H.id]=F}LCFController.init()},clearSysMsg:function(D){if(typeof D=="undefined"){return }var A=MsgSystem.sys_msg_types[D];LCF.set("sys_"+A,"0");Blinker.stop();var C=LCF.get("sys_all_msg");if(C!=null){var B=C.split(",");B[D-1]=0;LCF.set("sys_all_msg",B.join(","))}},clearAllSysMsg:function(){LCF.set("sys_clear_msg","[0,0,0]");LCFController.removeMsgByMod("sys")},handleBeansMsg:function(){var url="/f?ct=486539264&cm=59202&tn=jsonUserInfo&t="+Math.random();TbAjax.get(url,function(xhr){var data=eval("("+xhr.responseText+")");if(data.beans_num){LCF.set("sys_wealth",data.beans_num);setTimeout(function(){MsgLoader._sendClearRequest(3);LCF.remove("sys_wealth")},100)}})}};MsgSystem.onlineStats=function(){var D=new Date().getTime();UserBar._getUserInfo();var A=UserBar.user_info.portrait;var C="http://message.tieba.baidu.com/i/msg/online?user="+A+"&t="+D;var B=new Image();window.tb_online_stats=B;B.src=C};MsgSystem.dispatchMsg=function(B){if(!B){return }debugMsg("<br />@MsgSystem.dispatch; Get msg from listen interface or message which type == 'msg_pack'! <br />MsgMod : "+B.mod+";type:"+B.msg["type"]+";cnt: "+B.msg["cnt"]);if(B==null||!("mod" in B)||B.msg["type"]=="null"){return }var F=B.mod;var I=B.msg["type"];var E="";var J=B.msg["cnt"];var G="";debugMsg("<h4>-------  Beign 从listen接口接受到消息进行分发  ---------</h4>");switch(F){case"sys":E=MsgSystem.sys_msg_types[I];if(typeof E=="undefined"){E=I}break;case"chat":if(I=="sys_msg"){G=J.match(/^sysconn\_\d/);if(G==""||G==null){G="sys_msg"}}else{if(I=="chat_msg"){G="chat_msg"}else{if(I=="msg_pack"){var A=J;for(var D=0;D<A.length;D++){MsgSystem.dispatchMsg(A[D])}}}}E=MsgSystem.chat_msg_types[G];if(typeof E=="undefined"){E=I}break;default:E=I;break}var H=B.mod+"_"+E;if(H=="sys_wealth"){MsgSystem.handleBeansMsg();return }var C=B.msg["cnt"];debugMsg("@MsgSystem.dispatch; Set msg to flash storage ! <br />MsgId : "+H+";MsgCnt: "+C+"<br />");debugMsg("<h4>-------  End 从listen接口接受到消息进行分发  ---------</h4>");LCF.set(H,C)};MsgSystem.start=function(){var B=new Object(UserBar.user_info);var D=B.is_login;if(this.need_start==false||D==0||D==false){return }UserBar._getUserInfo();var A=UserBar.user_info.portrait;var C=UserBar.product;if(D&&("string"==typeof A)&&A!=""){MsgSystem.init(C,{itieba_id:0,portrait:A})}WealthSystem.PostTip.show()};(function(){if(document.attachEvent){window.attachEvent("onload",function(){MsgSystem.start()})}else{window.addEventListener("load",function(){MsgSystem.start()},false)}})();var MsgHandler={tip_ele:null,fans:function(B){var A=parseInt(B);if(A>0){this._showUserBarTip("fans",A,"新粉丝")}else{this._hideUserBarTip("fans")}},evaluate:function(D){var C=parseInt(D);var A=document.getElementById("new_evaluate_num_tip");var B="";if(C>0){this._showUserBarTip("evaluate",C,"新评价");B="("+D+"新)";Blinker.blink("","新评价")}else{this._hideUserBarTip("evaluate");Blinker.stop()}if(A){A.innerHTML=B}},wealth:function(D){var B=parseInt(D);var C=WealthSystem.action_type;if(B>0){if(typeof C=="string"&&(C=="add_post")){debugMsg("@MsgHandler.wealth;add_post action,set cookie for show tip,display after reloaded!");WealthSystem.PostTip.setDisplay(true)}else{debugMsg("@MsgHandler.wealth;display!");var A='<div class="tb_beans_msg_tip">恭喜你，贴吧豆增收啦！<br />当前总数：<span class="tb_beans_num_tip"><b>'+D+"</b></span>个</div>";SimplePopupMsg.show(A)}}},feature:function(D){var C=parseInt(D);var A=document.getElementById("new_feature_num_tip");var B="";if(C>0){this._showUserBarTip("feature",C,"新精品");B="("+D+"新)";Blinker.blink("","新精品")}else{this._hideUserBarTip("feature");Blinker.stop()}if(A){A.innerHTML=B}},reply:function(D){var C=parseInt(D);var A=document.getElementById("new_reply_num_tip");var B="";if(C>0){this._showUserBarTip("reply",C,"新回复");B="("+D+"新)"}else{this._hideUserBarTip("reply")}if(A){A.innerHTML=B}},guess:function(B){var A=parseInt(B);if(A>0){this._showUserBarTip("guess",A,"竞猜结果");Blinker.blink("","竞猜结果")}else{this._hideUserBarTip("guess");Blinker.stop()}},all_msg:function(G){Blinker.mode="sync";var F=G.split(",");var D=MsgSystem.sys_msg_types;var E=D.length-1;var B;for(var C=0,A=F.length;C<A;C++){num=F[C];if(C<E&&num>0){B=D[C+1];if(typeof MsgHandler[B]!="undefined"){MsgHandler[B](num)}}}Blinker.mode="async"},clear_msg:function(H){var G=this.tip_ele;var F=G.getElementsByTagName("li");for(var E=0,B=F.length;E<B;E++){F[E].style.display="none"}G.style.display="none";var A=null;var D="";for(var C in MsgSystem.SYS_MSG_CONF){D=MsgSystem.SYS_MSG_CONF[C]["aside_tip_id"];debugMsg("@clear_msg"+D);if(typeof D=="string"&&D!=""){A=document.getElementById(D);if(A){A.innerHTML="";A.style.display="none"}}}Blinker.stop()},_showUserBarTip:function(D,B,F){var H=document.getElementById("message_"+D);var C=MsgSystem.SYS_MSG_CONF[D];if(C.display==false||!H){return }var E=C.id;var A=C.url;var G="st_mod="+D+"_tip&fr=tb0_"+MsgSystem.product;H.innerHTML="有"+B+'个<a href="'+A+'" onclick="MsgLoader.clearData('+E+");Statistics.sendRequest('"+G+'\');" target="'+MsgSystem.link_taget+'">'+F+"</a>";H.style.display="block";this.tip_ele.style.display="block";var I=document.getElementById("userbar_sign_in_guide");if(I){I.style.display="none"}},_hideUserBarTip:function(D){var B=document.getElementById("message_"+D);var F=this.tip_ele;var E=F.getElementsByTagName("li");B.style.display="none";var G=true;for(var C=0,A=E.length;C<A;C++){if(E[C].style.display!="none"){G=false;break}}F.style.display=G?"none":"block"}};var TbNet={data_url:"http://message.tieba.baidu.com/i/msg/get_data",listen_url:"http://message.tieba.baidu.com/i/msg/listen",listen_num:0,listening:false,connect:function(){var A=this.data_url+"?user="+MsgSystem.user.portrait;TbNet.listen();TbAjax.loadjs(A)},listen:function(){if(TbNet.listening){TbNet.stoplisten()}var A=this.listen_url+"?user="+MsgSystem.user.portrait;TbNet.listen_num=LCF.listen(A,"TbNet.dataHandler","TbNet.statusListenStatus");TbNet.listening=true},stopListen:function(){LCF.stopListen(TbNet.listen_num);TbNet.listening=false},statusListenStatus:function(A){if(A){LCF.set("chat_command_listen","start");debugMsg("<h3>@TbNet.listen; listening...消息系统开始侦听</h3>")}else{LCF.set("chat_command_listen","end");debugMsg("<h3>@TbNet.nolisten; nolistening...消息系统侦听断开</h3>")}},dataHandler:function(A){if(A&&A!=""){debugMsg("<h3>[[[==========  Begin 从listen接口收到数据  ==========]]]</h3>");var B=A.replace(/^TbNet.dataHandler\(|\)\;?$/g,"");B=B.replace(/\:\'\[/g,":[");B=B.replace(/\]\'\}/g,"]}");try{B=TbUtil.json.decode(B)}catch(C){B=false}MsgSystem.dispatchMsg(B);debugMsg("<h3>[[[==========  End 从listen接口收到数据  ==========]]]</h3>")}}};var MsgLoader={clearData:function(A){this._sendClearRequest(A);MsgSystem.clearSysMsg(A)},_sendClearRequest:function(D){var C=new Date().getTime();var B="http://message.tieba.baidu.com/i/msg/clear_data?type="+D+"&user="+MsgSystem.user.portrait+"&stamp="+C;var A=new Image();window["itieba_msg_clearer_"+C]=A;A.src=B},clearAllData:function(){var B=MsgSystem.SYS_MSG_CONF;var C=0;for(var A in B){C=B[A]["id"];if(C>0){this._sendClearRequest(C)}}MsgSystem.clearAllSysMsg()}};function initItiebaMessage(D){var C=false;for(var B=0,A=D.length;B<A;B++){if(D[B]>0){C=true;break}}if(A>=3&&D[2]>0){D[2]=0;MsgSystem.handleBeansMsg()}if(C){var E=D.join(",");LCF.set("sys_all_msg",E);debugMsg("@initItiebaMessage:has new msg.....  msg : "+E)}}var LCFController={is_lcf_ok:false,init:function(){var D=navigator.userAgent;var A=0;var B="TBMSG_"+MsgSystem.user.portrait;if(/MSIE (\d+(\.\d+)?)/.test(D)){A=RegExp.$1}if(A){B+="_IE"}else{B+="_FF"}var C={server:"LCFController.evokeServerTab"};if(itieba_msg_debug_mode){C.console="debugMsg"}LCF.init(B,LCFController.onMessageReady,C);var E=0;var F=setInterval(function(){E++;if(E>MSG_SYS_MXA_LOOP_NUM){clearInterval(F);debugMsg("<h3>Warnning: LCF 初始化失败！无法执行Get和Set操作！</h3>")}if(LCF.set("LCF_FUNC_IS_OK","1")){console.log("@LCFController.init; lcf is ok,loop count:"+E);clearInterval(F);LCFController.is_lcf_ok=true}},MSG_SYS_LOOP_INTERVAL)},onMessageReady:function(B,D){var A=B.indexOf("_");var C="custom";var E="";if(A==-1){E=B}else{C=B.slice(0,A);E=B.slice(A+1)}debugMsg("<h4>-------  Begin flash共享数据有更新  ---------</h4>");debugMsg('<span class="red">@LCFController.onMessageReady(); msg_mod : "'+C+"; msg_type :"+E+"; msg : "+D+"</span>");switch(C){case"sys":if(typeof MsgHandler[E]=="function"){debugMsg("@LCFController.onMessageReady(); dispatch to MsgHandler:"+E);MsgHandler[E](D)}break;case"chat":if(typeof TbChat!="undefined"){debugMsg("<br />-------  flash共享数据是随机聊天的消息  ---------");debugMsg("@LCFController.onMessageReady(); Handle chat msg; dispatch to TbChat.Controller.recMsg:"+E);TbChat.Controller.recMsg(E,D)}break;case"custom":if(typeof CustomMsgHandler.custom[E]=="function"){debugMsg("@LCFController.onMessageReady(); dispatch to CustomMsgHandler['custom']:"+E);CustomMsgHandler[E](D)}break;default:if(typeof CustomMsgHandler[C]=="object"&&typeof CustomMsgHandler[C][E]=="function"){debugMsg("@LCFController.onMessageReady(); default case, dispatch to CustomMsgHandler['"+C+"']"+E);CustomMsgHandler[E](D)}}debugMsg("<h4>-------  End flash共享数据有更新  ---------</h4>")},evokeServerTab:function(){MsgSystem.is_server=true;debugMsg("<h2>@LCFController.evokeServerTab;This is the server tab ... </h2>");LCFController.checkLcfReady(function(){TbNet.connect()});MsgSystem.onlineStats();setInterval(function(){MsgSystem.onlineStats()},ONLINE_LISTEN_TIME)},checkLcfReady:function(C){var A=0;var B=setInterval(function(){A++;if(A>MSG_SYS_MXA_LOOP_NUM){clearInterval(B);debugMsg('<h3 style="color:red;">Warnning: CheckLcfReady 失败！无法callback操作！</h3>')}if(LCFController.is_lcf_ok==true){console.log("@LCFController.checkLcfReady; is ready, loop count: "+A);clearInterval(B);B=null;C()}},MSG_SYS_LOOP_INTERVAL)},removeMsgByMod:function(B){var C=LCF.getAll();var D="";for(var A in C){if(A.indexOf(B)==0){D=A.slice(A.indexOf(B)+1);if(D!="command_listen"){LCF.remove(A)}}}}};var Blinker={mode:"async",real_title:"",text:"",count:0,timer:null,num:0,start:function(){Blinker.count=Blinker.count+1;if(Blinker.count%2==0){document.title="【"+Blinker.text+"】_"+Blinker.real_title}else{document.title="【　　　】_"+Blinker.real_title}if(Blinker.count==16){Blinker.stop()}},blink:function(B,A){if(this._isNeed()){Blinker.text=A;Blinker.stop();Blinker.num=B;Blinker.timer=setInterval(Blinker.start,1000)}},stop:function(){if(Blinker.timer!=null){document.title=Blinker.real_title;clearInterval(Blinker.timer)}Blinker.count=0},_isNeed:function(){return(MsgSystem.is_server&&Blinker.mode=="async")?true:false}};function debugMsg(B){if(itieba_msg_debug_mode){var A=document.getElementById("LCF_info");if(A){var C=document.createElement("div");C.innerHTML=B;A.appendChild(C)}A=null}}function clearDebug(){document.getElementById("LCF_info").innerHTML=""}var CustomMsgHandler={custom:{}};var WealthSystem={chunjie_tip:'<p style="font-size:12px;color:red;padding-top:6px;">春节(2.07～2.19)上贴吧，获得双倍贴吧豆</p>',UserBarGuide:{cookie_key:"TB_BAR_SIGNIN_GUIDE_NEW",cookie_key_chuxi_gift:"TB_BAR_CHUXI_TIP",showSignInTip:function(){if(WealthSystem.isChuXi()){if(WealthSystem._getCookie(this.cookie_key_chuxi_gift)==null){document.getElementById("userbar_sign_in_guide").style.display="block";var A="http://static.tieba.baidu.com/tb/zt/hot2010_tieba/userbar_gift_link.js?t="+new Date().getTime();TbAjax.loadjs(A)}}else{if(WealthSystem._getCookie(this.cookie_key)==null){document.getElementById("userbar_sign_in_guide").style.display="block"}}},closeSignInTip:function(){var D=24*3600*1000;var E=new Date();var A=E.getTime();var C=0;if(WealthSystem.isChuXi()){var B=new Date(2010,1,13,20,0,0).getTime();if(A<B){C=B}else{C=Date.parse("2/14/2010")}D=C-A;WealthSystem._setCookie(this.cookie_key_chuxi_gift,"1",D);document.getElementById("userbar_sign_in_guide").style.display="none"}else{D=D*365;WealthSystem._setCookie(this.cookie_key,"1",D);document.getElementById("userbar_sign_in_guide").style.display="none"}},showSignOutTip:function(){var url="/f?ct=486539264&cm=59202&tn=jsonUserInfo&t="+Math.random();TbAjax.get(url,function(xhr){var data=eval("("+xhr.responseText+")");if(data.today_beans_num){var _html='<div class="tb_beans_msg_tip">今日已收入贴吧豆<span class="tb_beans_num_tip"><b>'+data.today_beans_num+"</b></span><br />继续努力吧:)"+(WealthSystem.isInChunJie()==true?WealthSystem.chunjie_tip:"")+"</div>";SimplePopupMsg.show(_html)}})}},_setCookie:function(D,E,A){var F=new Date();var C=F.getTime();F.setTime(A+C);var B=D+"="+E+";domain=tieba.baidu.com;path=/;expires="+F.toGMTString();document.cookie=B},isInChunJie:function(){var C=new Date();var A=C.getTime();var B=Date.parse("2/19/2010");return(A<B)?true:false},isChuXi:function(){var D=new Date();var A=D.getTime();var C=Date.parse("2/13/2010");var B=Date.parse("2/14/2010");return(A>C&&A<B)?true:false},_getCookie:function(B){var C=new RegExp("(^| )"+B+"=([^;]*)(;|$)");var A=document.cookie.match(C);if(A){return unescape(A[2])}return null},EditorGuide:{cookie_key:"TB_POST_SIGNIN_GUIDE",show:function(){if(WealthSystem._getCookie(this.cookie_key)==null){var A='<div class="tb_beans_msg_tip">友情提示：登录发贴可获赠贴吧豆！<br /></div>';SimplePopupMsg.show(A);var B=(24*60)*60*1000;WealthSystem._setCookie(this.cookie_key,"1",B)}},isNeed:function(){if(UserBar.user_info.is_login){return false}if(WealthSystem._getCookie(this.cookie_key)==null){return true}else{return false}}}};WealthSystem.chuxiGiftLinkCallBack=function(B){var A=document.getElementById("chuxi_gift_link");if(A){A.innerHTML='<a href="'+B+'" target="_blank">查看详细</a>'}};WealthSystem.action_type="default";WealthSystem.PostTip={cookie_key:"TB_SHOW_WEALTH_TIP",show:function(){if(WealthSystem._getCookie(this.cookie_key)==null){return true}debugMsg("@MsgHandler.wealth;has cookie, display tip!");this.setDisplay(false);var url="/f?ct=486539264&cm=59202&tn=jsonUserInfo&t="+Math.random();TbAjax.get(url,function(xhr){var data=eval("("+xhr.responseText+")");if(data.beans_num){var _html='<div class="tb_beans_msg_tip">恭喜你，贴吧豆增收啦！<br />当前总数：<span class="tb_beans_num_tip"><b>'+data.beans_num+"</b></span>个</div>";SimplePopupMsg.show(_html)}})},setDisplay:function(A){var B=1000;if(A==true){B=120*1000}WealthSystem._setCookie(this.cookie_key,"1",B)}};function WHG(A){return document.getElementById(A)}function setOpacity(A,B){A.style.filter="alpha(opacity="+B+")";A.style.opacity=B/100}var webHi={posStartX:0,posEndX:0,posStartY:0,posEndY:0,posAlpha:0,posState:0,tempNum:0,xStep:3,eventHandler:null,closeEventHandler:null,textBlock:null,textTip:null};webHi.textBlock=WHG("hiIcon");webHi.textTip=WHG("hiMsg");function openTip(A){WHG("hiIcon").title=WHG("hiMsg").title="您的百度Hi有新消息，点击读取";WHG("msgRight").innerHTML=A;var B=String(A).length;webHi.posEndX=6*B+6;webHi.posStartX=0;webHi.posStartY=0;webHi.posEndY=-4;webHi.textBlock=document.getElementById("hiIcon");webHi.textTip=document.getElementById("hiMsg");webHi.textTip.style.marginTop=webHi.posStartY+"px";if(webHi.posState>=3){webHi.posState=1;webHi.posAlpha=0}if(webHi.tempNum!=B){webHi.tempNum=B;webHi.posState=0;webHi.textBlock.style.marginRight=0;webHi.textTip.style.display="none"}clearInterval(webHi.closeEventHandler);webHi.closeEventHandler=null;clearInterval(webHi.eventHandler);webHi.eventHandler=setInterval(openMoveEvent,2)}function closeTip(){webHi.posStartY=0;webHi.posAlpha=0;webHi.textTip.style.display="none";webHi.posStartX=webHi.posEndX;webHi.posEndX=0;clearInterval(webHi.eventHandler);webHi.eventHandler=null;clearInterval(webHi.closeEventHandler);webHi.closeEventHandler=setInterval(closeMoveEvent,2);WHG("hiIcon").title=WHG("hiMsg").title="发起即时会话";WHG("msgRight").innerHTML="0"}function closeMoveEvent(){if(webHi.posStartX<=webHi.posEndX){clearInterval(webHi.closeEventHandler);webHi.closeEventHandler=null;webHi.posStartX=webHi.posEndX;webHi.textBlock.style.marginRight=webHi.posStartX+"px";return }webHi.posState=0;webHi.textBlock.style.marginRight=webHi.posStartX+"px";webHi.posStartX-=webHi.xStep}function openMoveEvent(){switch(webHi.posState){case 0:webHi.textBlock.style.marginRight=webHi.posStartX+"px";webHi.posStartX+=webHi.xStep;if(webHi.posStartX>=webHi.posEndX){webHi.posState=1;webHi.textBlock.style.marginRight=webHi.posEndX+"px";webHi.textTip.style.marginLeft=(0-webHi.posEndX)+"px"}break;case 1:setOpacity(webHi.textTip,webHi.posAlpha);webHi.textTip.style.display="block";webHi.posState=2;break;case 2:if(webHi.posStartY>=webHi.posEndY){webHi.textTip.style.marginTop=webHi.posStartY--+"px"}var A=Math.abs(Math.sin(3.1415*webHi.posAlpha/180)*100);setOpacity(webHi.textTip,A);webHi.posAlpha+=10;if(webHi.posAlpha>=640){setOpacity(webHi.textTip,100);webHi.posState=3}break;case 3:clearInterval(webHi.eventHandler);webHi.eventHandler=null;return }}window.IMOld=(function(){var E=null,D=0,F=null,B=null;G.interval=30*1000;G.url="http://fetch.im.baidu.com/ihaloader?op=msgcount&charset=gbk&callback=IMOld&refer=tieba.baidu.com";G.reset=function(){G.onchange(0);H(0);if(G.timer){clearInterval(G.timer)}C()};G.fetch=function(){E=A();B=new Date().getTime();if(E){E=E.split("|");B=parseInt(E[1],36);D=E[0];E=null}setTimeout(function(){I();C();if(D>0&&typeof (G.onchange)=="function"){G.onchange(D)}},1000)};function I(){H(D);F=document.createElement("SCRIPT");F.type="text/javascript";F.src=G.url+(G.url.indexOf("?")>0?"&":"?")+".stamp="+new Date().getTime().toString(36);document.getElementsByTagName("HEAD")[0].appendChild(F)}function H(L){var J=new Date(),K=J.getTime();J.setTime(K+3*G.interval);document.cookie="IM_old="+L+"|"+K.toString(36)+";domain=baidu.com;path=/;expires="+J.toGMTString();if(F){F.parentNode.removeChild(F);F=null}}function A(){var J=document.cookie.match(/(^| )IM_old=([^;]*)(;|$)/);if(J!=null){return unescape(J[2])}return null}function C(){G.timer=setInterval(function(){var J=A(),L=0,K=0;if(J){J=J.split("|");K=parseInt(J[1],36);L=J[0];J=null}if(Math.abs(new Date().getTime()-K)>G.interval){I()}if(D!=L){D=L;if(typeof (G.onchange)=="function"){G.onchange(L)}}},500)}function G(J){H(J)}return G})();window.startBaiduHi=(function(){var A={PSP_OFFLINE:0,USERNAME_IS_NULL:1,USERNAME_IS_SELF:2,USERNAME_NOT_EXSITS:3};var M="__IM_REDIRECT_IFRAME";var C={message:true};var I=navigator.userAgent.indexOf("MSIE")>-1&&!window.opera,H=navigator.userAgent.indexOf("Firefox")!=-1;function D(T){if(T!==undefined&&T!==null&&T!==""){return true}return false}function Q(){var T={version:null,detect:null};if(I){try{T.detect=new ActiveXObject("WebDetect.Detect");T.version=T.detect.GetVersion()}catch(U){}}else{if(H){try{if(typeof (navigator.mimeTypes["application/x-baiduhi"])=="object"){T.version=".*"}}catch(U){}}}return T}function J(){var T=Q();if(T.version){return true}return false}function K(Y){var W=Q(),V=W.detect;if(V){var U=null,T=false;try{U=V.GetWebDetectVersion();T=V.IsClientOnline(Y)}catch(X){}return T}else{return false}}function N(){var T=T||parent.webim;if(T&&T.api&&T.api.System&&T.External){return true}return false}function O(T){if(C[T]){return true}return false}function L(){var T=T||parent.webim;if(T.api.System.isAvailable()){return true}return false}function E(U){if(N()){var T=T||parent.webim;T.api.System.isPassportOnline(function(V){U(V)})}else{U(false)}}function S(){if(N()){var U=U||parent.webim;var T=U.api.System.getStatus();if(T=="online"){return true}return false}else{return false}}function G(Z,U,Y,X,W){U=U||"";Y=Y||"";var V,T="baidu://"+Z+"/?sid="+U+"&id="+Y+R(X);if(I){T+="&browser=IE"}else{if(H){T+="&browser=FF&promo=c2cmsg|message|addgroup|creategroup|addcontact"}}V=document.getElementById(M);if(!V){V=document.createElement("iframe");V.id=M;V.style.display="none";document.body.insertBefore(V,document.body.firstChild)}V.src=T;P(Z,U,Y,X,"client");if(X&&X.onim){X.onim()}}function F(Y,T,X,W,U){var V=V||parent.webim;if(N()){if(S()){V.External.startChat(X,function(Z,a,b){if(!Z){switch(a){case 0:U(A.PSP_OFFLINE);break;case 1:U(A.USERNAME_IS_NULL);break;case 2:U(A.USERNAME_IS_SELF);break;case 3:U(A.USERNAME_NOT_EXSITS);break}}})}else{E(function(a){if(a){var Z=new Date(),b=Z.getTime();Z.setTime(b+30*1000);document.cookie="ML_"+Y+"="+escape(X+"|"+window.location.host+"|"+(new Date().getTime()).toString(36))+";expires="+Z.toGMTString();V.api.Self.setStatus("online")}else{U(A.PSP_OFFLINE)}})}}P(Y,T,X,W,"mulan");if(W&&W.onmulan){W.onmulan()}}function B(Z,U,Y,X,V){var T=new Date(),W=T.getTime();T.setTime(W+30*1000);if(Z=="addgroup"){document.cookie="IM_groupadd="+escape(Y+"|"+window.location.host+"|"+(new Date().getTime()).toString(36))+";domain=baidu.com;path=/;expires="+T.toGMTString()}else{document.cookie="IM_add="+escape(Y+"|"+window.location.host+"|"+(new Date().getTime()).toString(36))+";domain=baidu.com;path=/;expires="+T.toGMTString()}if(!/(^| )IM_=/.test(document.cookie)){if(B.form&&B.form.tagName=="FORM"){B.form.submit();return }var W=document.createElement("DIV");W.style.display="none";document.body.insertBefore(W,document.body.firstChild);W.innerHTML="<form name='__IM_REDIRECT_FORM' method='get' target='baidu_webim' action='http://web.im.baidu.com'></form>";B.form=document.forms.__IM_REDIRECT_FORM;B.form.submit();W=null}P(Z,U,Y,X,"standard");if(X&&X.onwebim){X.onwebim()}}function P(Z,T,Y,W,V){var X=document.getElementById("__IM_REPORT_HOLDER");if(!X){X=document.createElement("div");X.style.display="none";X.id="__IM_REPORT_HOLDER";document.body.insertBefore(X,document.body.firstChild)}var U=document.createElement("img");X.appendChild(U);U.onerror=U.onload=function(){U.onerror=U.onload=null;X.removeChild(U)};U.src="http://im.baidu.com/nop?open="+V+"&type="+Z+"&sid="+T+"&id="+Y+R(W)+"&t="+new Date().getTime()}function R(U){var T=[];for(prop in U){if(prop.substring(0,2)!="on"){T.push(prop+"="+U[prop])}}return(T.length>0?"&"+T.join("&"):"")}return function(X,T,W,V,U){if(D(T)){if(K(T)){G(X,T,W,V,U)}else{if(N()&&O(X)&&L()){F(X,T,W,V,U)}else{B(X,T,W,V,U)}}}else{if(J()){G(X,T,W,V,U)}else{F(X,T,W,V,U)}}}})();window.IMOld.onchange=function(A){if(A>0){openTip(A)}else{closeTip()}};function onimFunc(){IMOld.reset()}var jsonFunction={onim:onimFunc};function openIM(C,B,A,D){clearInterval(webHi.eventHandler);webHi.eventHandler=null;Statistics.sendRequest("st_type=web_im&st_mod=userbar&fr=tb0_forum");window.startBaiduHi(C,B,A,jsonFunction,TbUtil.hiPopHandler)}function startShowHiMsg(A){if(window.IMOld.url.indexOf("&un=")>0){return }window.IMOld.url+="&un="+A;IMOld.fetch()}var NsLogLinker={_pid:0,stat:function(C,B){var E="nslog__"+(new Date()).getTime();var D=window[E]=new Image();var A=B||this._pid;D.onload=(D.onerror=function(){window[E]=null});D.src="http://nsclick.baidu.com/v.gif?pid="+A+"&url="+encodeURIComponent(C)+"&t="+(new Date()).getTime()+"&type=0";D=null},_checkEvent:function(C){C=C||event;var B=C.srcElement||C.target;if(B.nodeType!=1){B=B.parentNode}while(B&&B.tagName&&B.tagName.toUpperCase()!="A"){B=B.parentNode}if(B&&B.tagName&&B.tagName.toUpperCase()=="A"){if(!/^([\w-]+\.)*?baidu\.com/i.test(B.host)){var A=B.href;setTimeout(function(){NsLogLinker.stat(A)},1)}}B=null},isOutLink:function(A){return(!/([\w-]+\.)*?baidu\.com/i.test(A))},bind:function(A){this._pid=A;if(document.attachEvent){document.attachEvent("onmousedown",this._checkEvent);window.attachEvent("onunload",function(){document.detachEvent("onmousedown",NsLogLinker._checkEvent)})}else{document.addEventListener("mousedown",this._checkEvent,false);window.addEventListener("unload",function(){document.removeEventListener("mousedown",NsLogLinker._checkEvent,false)},false)}}};var ForumLoginHelper={showLoginLayer:function(A){TbUtil.login()},isLogined:function(forumID,forumName,callbackFunc){var me=this;var data=["ct=486539264","cm=59107","lm="+forumID,"word="+forumName,"tn=resultNo","stamp="+new Date().getTime()];var url="/f";var req=new Ajax.Request(url+"?"+data.join("&"),{method:"get",asynchronous:true,parameters:"",onComplete:function(xhr){var result=eval("("+xhr.responseText+")");callbackFunc((result.resultNo==0))}})}};var SimplePopupMsg={delayTime:3000,show:function(B,G,F){var D='<div class="simple_popup_msg"'+(G?(' id="'+G+'" '):"")+'> <div class="rc_top"><b></b><i></i></div> <div class="rc_content"><div class="cnt">'+B+' </div></div> <div class="rc_bottom"><b></b><i></i></div></div>';var C=this.getPopupElem();var A=this.getBody();C.style.top=Math.max((parseInt(A.viewHeight/2)+A.scrollTop-40),0)+"px";C.style.left=Math.max((parseInt(A.viewWidth/2)+A.scrollLeft-100),0)+"px";C.style.zIndex=30000;C.style.filter="alpha(opacity="+0+")";C.style.opacity=0;C.innerHTML=D;C.style.display="";var E=this;E._slowShow(C,1,10);setTimeout(function(){E.hide()},F||SimplePopupMsg.delayTime)},getBody:function(){var A=0,I=0,E=0,C=0,B=0,J=0;var F=window,D=document,G=D.documentElement;A=G.clientWidth||D.body.clientWidth;I=F.innerHeight||G.clientHeight||D.body.clientHeight;C=D.body.scrollTop||G.scrollTop;E=D.body.scrollLeft||G.scrollLeft;B=Math.max(D.body.scrollWidth,G.scrollWidth||0);J=Math.max(D.body.scrollHeight,G.scrollHeight||0,I);return{scrollTop:C,scrollLeft:E,documentWidth:B,documentHeight:J,viewWidth:A,viewHeight:I}},_slowShow:function(D,A,B){var C=this;if(A<=10){D.style.filter="alpha(opacity="+(A*10)+")";D.style.opacity=A*0.1;setTimeout(function(){C._slowShow(D,(A+1),B)},B)}},getPopupElem:function(){var A=document.getElementById("simplePopupMsg_wrap");if(!A){A=document.createElement("div");A.id="simplePopupMsg_wrap";A.style.position="absolute";document.body.insertBefore(A,document.body.firstChild)}return A},hide:function(){this.getPopupElem().style.display="none"}};var SimpleTipMsg=function(B,E,C,D){this.view_panel_id=B;this.cookie_name=E;this.cookie_option=C||{path:"/",expires:(3600*1000*24*30*12),domain:"tieba.baidu.com"};this.view_html=D;var A=Fe.Cookie.get(E);if(!A){if(D){Fe.G(B).innerHTML=D}Fe.show(B)}};SimpleTipMsg.prototype.close=function(){Fe.Cookie.set(this.cookie_name,"readed",this.cookie_option);Fe.hide(this.view_panel_id)};if(typeof TbUtil=="undefined"){var TbUtil={}}TbUtil.setDomain=function(B){var B=B||"parent";if(B=="top"){try{var A=top.window.location.href}catch(C){try{document.domain="tieba.baidu.com";var A=top.window.location.href}catch(C){document.domain="baidu.com"}}}else{try{var A=parent.window.location.href}catch(C){try{document.domain="tieba.baidu.com";var A=parent.window.location.href}catch(C){document.domain="baidu.com"}}}};