

linux下编译命令


查找库是否存在这个接口
nm DFITCTraderApi.so > test
nm libapr-1.a > test
nm libapr-1.a  | grep apr_pollcb_create_ex
objdump -t libapr-1.so.0.4.6|grep apr_pollcb_create_ex
ldd ApiDemo

强杀一个进程
ps -ef | grep -rin apidemo
115:root     19692 15519  0 14:33 pts/3    00:00:00 ./ApiDemo
120:root     19808  3920  0 14:34 pts/5    00:00:00 grep -rin apidemo
kill -9 19692



apr编译命令
tar zxvf apr-1.4.6.tar.gz
cd apr-1.4.6
./configure CFLAGS=-fPIC -prefix=/usr/src/test/apr_inc
make install
cd ..
rm -rf apr-1.4.6


log命令

cd public/log/
g++ -I../../apr_inc/include/apr-1/ -fPIC -c log.cpp
ar -v -r log.a log.o
rm -rf *.o
rm -rf ../../lib/log.a
mv log.a ../../lib/
cd ../../


session命令

g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c session.cpp
g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c tcpframe.cpp
ar -v -r session.a session.o tcpframe.o
rm -rf *.o
rm -rf ../../lib/session.a
mv session.a ../../lib/
 

threadpool命令
g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c lock.cpp
g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c thread.cpp
g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c task_manager.cpp
g++ -I../../apr_inc/include/apr-1/ -I../log/ -fPIC -c thread_pool.cpp
ar -v -r threadpool.a lock.o thread.o task_manager.o thread_pool.o
rm -rf *.o
rm -rf ../../lib/threadpool.a
mv threadpool.a ../../lib/



xspeed-api命令
g++ -I../../apr_inc/include/apr-1/ -I../../public/log/ -I../../public/session/ -I../../public/threadpool/ -I../../include/ -I../../public/share/ -fPIC -c TraderSpiTask.cpp
g++ -I../../apr_inc/include/apr-1/ -I../../public/log/ -I../../public/session/ -I../../public/threadpool/ -I../../include/ -I../../public/share/ -fPIC -c DFITCTraderApi.cpp
g++ -I../../apr_inc/include/apr-1/ -I../../public/log/ -I../../public/session/ -I../../public/threadpool/ -I../../include/ -I../../public/share/ -fPIC -c DFITCApiStruct.cpp
rm -rf ../../lib/*.o
mv *.o ../../lib/


生成动态库
rm -rf libapr-1.a
cp ../apr_inc/lib/libapr-1.a ./
g++ -lpthread DFITCApiStruct.o DFITCTraderApi.o TraderSpiTask.o log.a session.a threadpool.a libapr-1.a -shared -o DFITCTraderApi.so
rm -rf /usr/lib64/DFITCTraderApi.so
cp DFITCTraderApi.so /usr/lib64/




调用动态库
g++ -I../include/ -c ApiDemo.cpp
g++ -lpthread DFITCTraderApi.so ApiDemo.o -o ApiDemo
./ApiDemo




g++ DFITCTraderApi.o TraderSpiTask.o -lpthread -lexpat libapr-1.a log.a session.a threadpool.a -shared -o DFITCTraderApi.so
./ApiDemo: error while loading shared libraries: DFITCTraderApi.so: cannot open shared object file: No such file or directory

g++ -lpthread -lDFITCTraderApi libapr-1.a ApiDemo.o -o ApiDemo







编译问题
[root@BJ-TRADE-01 lib]# ./ApiDemo 
./ApiDemo: error while loading shared libraries: DFITCTraderApi.so: cannot open shared object file: No such file or directory


error while loading shared libraries的解Q方法
 者 icq 21:03 | oBBYW址 |  (0) | 引用 (1) | c次 (270) | Programming
 行程式r，如此遇到像下列@Ne`：

./tests: error while loading shared libraries: xxx.so.0:cannot open shared object file: No such file or directory


那就表示系y不知道xxx.so 放在哪目下。

@r候就要在/etc/ld.so.conf中加入xxx.so所在的目。

 一般而言，有很多son在/usr/local/lib@目下，所以在/etc/ld.so.conf中加入/usr/local/lib@一行，可以解Q此}。

 

 /etc/ld.so.conf存n後，要绦小/sbin/ldconfig Cv」砀新一下才生效。


vi /etc/ld.so.conf
/sbin/ldconfig -v



任凯号 11:21:40
    Vi /etc/selinux/config
         将SELINUX=enforcing 改为SELINUX=disabled
      然后cd /usr/lib
      执行如下语句chcon -t texrel_shlib_t libsafeengine32.so
                     chcon -t texrel_shlib_t libsecrypt32.so
g++ -lpthread -lDFITCTraderApi libapr-1.a ApiDemo.o -o ApiDemo






/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollcb_create_ex'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_join'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_wakeup'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_create'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_cond_wait'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_poll'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_cond_destroy'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_exit'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_remove'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_cond_create'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollcb_remove'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_destroy'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollcb_poll'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_add'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_cond_timedwait'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_thread_cond_broadcast'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollcb_add'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_threadattr_create'
/usr/lib/libDFITCTraderApi.so: undefined reference to `apr_pollset_create'








g++ -I../include/ -c TraderTest.cpp
g++ -lpthread DFITCTraderApi.so TraderTest.o -o TraderTest
./TraderTest



























[root@BJ-TRADE-01 DFITCTraderApi]# vi /etc/selinux/config 
      1 # This file controls the state of SELinux on the system.
      2 # SELINUX= can take one of these three values:
      3 #   enforcing - SELinux security policy is enforced.
      4 #   permissive - SELinux prints warnings instead of enforcing.
      5 #   disabled - SELinux is fully disabled.
      6 SELINUX=disabled
      7 # SELINUXTYPE= type of policy in use. Possible values are:
      8 #   targeted - Only targeted network daemons are protected.
      9 #   strict - Full SELinux protection.
     10 SELINUXTYPE=targeted
~                                                                                                                       
~                                                                                                                       
~                                                                                                                       
~   
[root@BJ-TRADE-01 DFITCTraderApi]# cd ..\
> cd /usr/src
-bash: cd: ..cd: 没有那个文件或目录
You have new mail in /var/spool/mail/root
[root@BJ-TRADE-01 DFITCTraderApi]# ls
DFITCTraderApi.cpp  libapr-1.a  libsession.a     resource.h         TraderSpiTask.h
DFITCTraderApi.o    liblog.a    libthreadpool.a  TraderSpiTask.cpp  TraderSpiTask.o

