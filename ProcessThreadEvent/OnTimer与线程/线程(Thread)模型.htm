<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0056)http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05s04.html -->
<HTML><HEAD><TITLE>&#32447;&#31243;(Thread)&#27169;&#22411;</TITLE>
<META http-equiv=Content-Type content="text/html; charset=ISO-8859-1"><LINK 
href="&#32447;&#31243;(Thread)&#27169;&#22411;.files/add.css" type=text/css rel=stylesheet>
<META content="MSHTML 6.00.2900.5726" name=GENERATOR><LINK title=ZK&#24320;&#21457;&#25163;&#20876; 
href="index.html" rel=start><LINK title=&#31532;&nbsp;5&nbsp;&#31456;&nbsp;&#20107;&#20214;&#30417;&#21548;&#21450;&#22788;&#29702; 
href="ch05.html" rel=up><LINK title=&#20107;&#20214;&#30417;&#21548;&#22120;&#25552;&#20132;,&#21457;&#36865;&#21644;&#22238;&#26174;&#20107;&#20214; href="ch05s03.html" 
rel=prev><LINK title=&#21021;&#22987;&#19982;&#28165;&#29702;&#20107;&#20214;&#22788;&#29702;&#32447;&#31243; href="ch05s05.html" rel=next></HEAD>
<BODY text=black vLink=#840084 aLink=#0000ff link=#0000ff bgColor=white>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH align=middle colSpan=3>&#32447;&#31243;(Thread)&#27169;&#22411;</TH></TR>
  <TR>
    <TD align=left width="20%"><A accessKey=p 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05s03.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH align=middle width="60%">&#31532;&nbsp;5&nbsp;&#31456;&nbsp;&#20107;&#20214;&#30417;&#21548;&#21450;&#22788;&#29702;</TH>
    <TD align=right width="20%">&nbsp;<A accessKey=n 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05s05.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>

<CENTER>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-2627642070897863";
/* docs-page-728x90, 08-9-16 */
google_ad_slot = "5345955928";
google_ad_width = 728;
google_ad_height = 90;
//-->
</SCRIPT>

<SCRIPT src="&#32447;&#31243;(Thread)&#27169;&#22411;.files/show_ads.js" type=text/javascript> 
</SCRIPT>
</CENTER></DIV>
<DIV class=sect1 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=id406744></A>&#32447;&#31243;(Thread)&#27169;&#22411;</H2></DIV></DIV></DIV>
<P>&#23545;&#20110;&#27599;&#20010;&#26700;&#38754;&#65292;&#20107;&#20214;&#24635;&#26159;&#34987;&#39034;&#24207;&#22788;&#29702;&#30340;&#65292;&#25152;&#20197;&#32447;&#31243;&#27169;&#22411;&#26159;&#24456;&#31616;&#21333;&#30340;&#12290;&#23601;&#20687;&#24320;&#21457;&#26700;&#38754;&#24212;&#29992;&#31243;&#24207;&#19968;&#26679;&#65292;&#20320;&#19981;&#38656;&#35201;&#25285;&#24515;racing&#21644;&#22810;&#32447;&#31243;(multi-threading)&#12290;&#25152;&#26377;&#20320;&#38656;&#35201;&#20570;&#30340;&#23601;&#26159;&#27880;&#20876;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#19988;&#20107;&#20214;&#34987;&#35843;&#29992;&#26102;&#22788;&#29702;&#23427;&#12290;</P>
<P>[&#25552;&#31034;]:&#24403;&#19968;&#20010;ZUML&#39029;&#38754;&#22312;servlet&#32447;&#31243;&#20013;&#34987;&#36171;&#20540;&#26102;&#65292;&#27599;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#37117;&#22312;&#19968;&#20010;&#34987;&#31216;&#20026;&#20107;&#20214;&#22788;&#29702;&#32447;&#31243;&#30340;&#29420;&#31435;&#32447;&#31243;&#20013;&#36816;&#34892;&#12290;</P>
<P>[&#25552;&#31034;]:&#20107;&#20214;&#22788;&#29702;&#32447;&#31243;&#30340;&#20351;&#29992;&#21487;&#20197;&#34987;&#31105;&#27490;&#65292;&#36825;&#26679;&#25152;&#26377;&#30340;&#32447;&#31243;&#37117;&#21487;&#20197;&#22312;Servlet&#32447;&#31243;&#20013;&#34987;&#22788;&#29702;&#12290;&#36825;&#26679;&#26377;&#26356;&#22909;&#19968;&#28857;&#30340;&#34920;&#29616;&#24182;&#19988;&#20943;&#23569;&#38598;&#25104;&#30340;&#38382;&#39064;&#12290;&#20294;&#26159;&#65292;&#20320;&#19981;&#33021;&#20013;&#27490;&#25191;&#34892;&#12290;&#21442;&#32771;&#24615;&#33021;&#25552;&#31034;&#19968;&#31456;&#20013;&#20351;&#29992;Servlet 
&#32447;&#31243;&#22788;&#29702;&#20107;&#20214;&#19968;&#33410;&#12290;</P>
<DIV class=sect2 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=id406764></A>&#25346;&#36215;&#21450;&#24674;&#22797;</H3></DIV></DIV></DIV>
<P>&#20026;&#20102;&#39640;&#32423;&#30340;&#24212;&#29992;&#65292;&#20320;&#25110;&#35768;&#24517;&#39035;&#25346;&#36215;&#19968;&#20010;&#25191;&#34892;&#30452;&#21040;&#19968;&#20123;&#26465;&#20214;&#34987;&#28385;&#36275;&#65292;<CODE 
class=code>org.zkoss.zk.ui.Executions</CODE>&#31867;&#20013;&#30340;<CODE 
class=code>wait</CODE>&#65292;<CODE class=code>notify</CODE>&#21644;<CODE 
class=code>notifyAll</CODE>&#26041;&#27861;&#37117;&#26159;&#20026;&#36825;&#26679;&#30340;&#30446;&#30340;&#32780;&#35774;&#35745;&#30340;&#12290;</P>
<P>&#24403;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#24819;&#25346;&#36215;&#33258;&#24049;&#65292;&#23427;&#21487;&#20197;&#35843;&#29992;<CODE class=code>wait</CODE>&#12290;&#22914;&#26524;&#30003;&#35831;&#30340;&#20855;&#20307;&#26465;&#20214;&#24471;&#21040;&#28385;&#36275;&#65292;&#21478;&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#36890;&#36807;<CODE 
class=code>notify</CODE>&#21644;<CODE 
class=code>notifyAll</CODE>&#26041;&#27861;&#21796;&#37266;&#23427;&#12290;&#23545;&#35805;&#26694;&#26159;&#20351;&#29992;&#36825;&#31181;&#26426;&#21046;&#30340;&#20856;&#22411;&#20363;&#23376;&#12290;</P><PRE class=programlisting>public void doModal() throws InterruptedException {
...
   Executions.wait(_mutex); //suspend this thread, an event processing thread
}
public void endModal() {
...
   Executions.notify(_mutex); //resume the suspended event processing thread
}
</PRE>
<P>&#23427;&#20204;&#30340;&#20351;&#29992;&#31867;&#20284;&#20110;<CODE class=code>java.lang.Object</CODE>&#20013;&#30340;<CODE 
class=code>wait</CODE>&#65292;<CODE class=code>notify</CODE>&#21644;<CODE 
class=code>notifyAll</CODE>&#26041;&#27861;&#12290;&#20294;&#26159;&#65292;&#20320;&#19981;&#33021;&#20351;&#29992;<CODE 
class=code>java.lang.Object</CODE>&#20013;&#30340;&#26041;&#27861;&#26469;&#25346;&#36215;&#21644;&#24674;&#22797;&#20107;&#20214;&#30417;&#21548;&#22120;&#12290;&#21542;&#21017;&#65292;&#20851;&#32852;&#21040;&#36825;&#20010;&#26700;&#38754;&#30340;&#25152;&#26377;&#30340;&#20107;&#20214;&#22788;&#29702;&#37117;&#20250;&#20572;&#28382;&#12290;</P>
<P>&#35831;&#27880;&#24847;&#65292;&#19981;&#21516;&#20110;Java&#30340;<CODE class=code>Object</CODE>&#31867;&#30340;<CODE 
class=code>wait</CODE>&#21644;<CODE class=code>notify</CODE>&#26041;&#27861;&#65292;&#26159;&#21542;&#20351;&#29992;&#21516;&#27493;&#30340;<CODE 
class=code>synchronized</CODE> block&#26469;&#21253;<CODE class=code>Executions</CODE>&#30340;<CODE 
class=code>wait</CODE>&#21644;<CODE 
class=code>notify</CODE>&#26159;&#21487;&#36873;&#30340;&#12290;&#22312;&#19978;&#36848;&#24773;&#20917;&#19979;&#20013;&#65292;&#25105;&#20204;&#24182;&#19981;&#38656;&#35201;&#36825;&#26679;&#20570;&#65292;&#22240;&#20026;&#27809;&#26377;&#21487;&#33021;&#30340;racing&#38382;&#39064;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#23384;&#22312;&#36825;&#26679;&#30340;racing&#38382;&#39064;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;<CODE 
class=code>synchronized</CODE> block&#65292;&#23601;&#20687;&#22312;Java <CODE 
class=code>Object</CODE>&#30340;<CODE class=code>wait</CODE>&#21644;<CODE 
class=code>notify</CODE>&#20013;&#20351;&#29992;&#37027;&#26679;&#12290;</P><PRE class=programlisting>//Thread 1
public void request() {
   ...
   synchronized (mutex) {
      ...//start another thread
      Executions.wait(mutex); //wait for its completion
   }
}

//Thread 2
public void process() {
   ... //process it asynchronously
   synchronized (mutex) {
      Executions.notify(mutex);
   }
}</PRE></DIV>
<DIV class=sect2 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=id406908></A>&#38271;&#25805;&#20316;(Long Operations)</H3></DIV></DIV></DIV>
<P>&#23545;&#20110;&#21516;&#19968;&#20010;&#26700;&#38754;&#32780;&#35328;&#65292;&#20107;&#20214;&#26159;&#34987;&#39034;&#24207;&#22788;&#29702;&#30340;&#12290;&#26368;&#22351;&#30340;&#24773;&#20917;&#19979;&#65292;&#30001;&#20110;HTTP&#30340;&#38480;&#21046;&#65292;&#29992;&#25143;&#20165;&#20250;&#30475;&#21040;&#26174;&#31034;&#22312;&#27983;&#35272;&#22120;&#24038;&#19978;&#26041;&#30340;&#19968;&#20010;&#23567;&#22788;&#29702;&#23545;&#35805;&#26694;&#32780;&#27809;&#26377;&#20854;&#20182;&#20219;&#20309;&#25552;&#31034;&#12290;</P>
<P>&#36890;&#36807;&#20351;&#29992;&#19978;&#38754;&#22238;&#26174;&#20107;&#20214;&#31456;&#33410;&#25551;&#36848;&#30340;&#22238;&#26174;&#20107;&#20214;&#21644;<CODE 
class=code>showBusy</CODE>&#26041;&#27861;&#65292;&#21017;&#21487;&#20197;&#25552;&#20379;&#26356;&#22810;&#25551;&#36848;&#24615;&#20449;&#24687;&#26469;&#25552;&#31034;&#29992;&#25143;&#25509;&#19979;&#26469;&#30340;&#34892;&#20026;&#65292;&#20363;&#22914;&#65292;&#28857;&#20987;&#20854;&#20182;&#25353;&#38062;&#20026;&#36827;&#19968;&#27493;&#36827;&#34892;&#38271;&#25805;&#20316;&#38477;&#20302;&#24615;&#33021;&#12290;</P>
<P>&#20294;&#26159;&#65292;&#38459;&#27490;&#26469;&#33258;&#29992;&#25143;&#30340;&#35775;&#38382;&#23545;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#32780;&#35328;&#20063;&#35768;&#26159;&#19981;&#21487;&#33021;&#30340;&#12290;&#20026;&#20102;&#38450;&#27490;&#38459;&#22622;&#65292;&#20320;&#24517;&#39035;&#22312;&#21478;&#19968;&#20010;&#32447;&#31243;&#20013;&#22788;&#29702;&#38271;&#25805;&#20316;&#65292;&#23601;&#20687;&#26700;&#38754;&#24212;&#29992;&#31243;&#24207;&#37027;&#26679;&#12290;&#28982;&#21518;&#65292;&#25345;&#32493;&#23558;&#22788;&#29702;&#29366;&#24577;&#36865;&#22238;&#23458;&#25143;&#31471;&#12290;</P>
<P>&#20351;&#29992;ZK&#65292;&#20320;&#26377;&#22235;&#31181;&#36873;&#25321;&#65306;&#26381;&#21153;&#22120;&#25512;&#21160;(server push)&#65292; &#25346;&#36215;&#21644;&#24674;&#22797;(suspend and resume)&#65292;timer, 
&#21644;&#25422;&#24102;(piggyback)&#12290;</P>
<DIV class=sect3 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H4 class=title><A name=id406945></A>&#36873;&#25321;1&#65306;&#26381;&#21153;&#22120;&#25512;&#21160;</H4></DIV></DIV></DIV>
<P>&#26381;&#21153;&#22120;&#25512;&#21160;&#21363;&#25152;&#35859;&#30340;&#21453;&#21521;Ajax(reverse-Ajax)&#65292;&#20801;&#35768;&#26381;&#21153;&#22120;&#23558;&#20869;&#23481;&#21160;&#24577;&#30340;&#21457;&#33267;&#23458;&#25143;&#31471;&#12290;&#36890;&#36807;&#20351;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#25216;&#26415;&#65292;&#24403;&#20320;&#39044;&#20808;&#23450;&#20041;&#30340;&#26465;&#20214;&#28385;&#36275;&#26102;&#65292;&#21017;&#21487;&#20197;&#22312;&#24037;&#20316;&#32447;&#31243;&#20869;&#23558;&#20869;&#23481;&#21457;&#33267;&#23458;&#25143;&#31471;&#25110;&#26356;&#26032;&#23458;&#25143;&#31471;&#30340;&#20869;&#23481;&#12290;&#20351;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#24456;&#31616;&#21333;&#65292;&#20165;&#38656;&#35201;&#22914;&#19979;&#30340;&#19977;&#27493;&#65292;</P>
<DIV class=orderedlist>
<OL type=1>
  <LI>
  <P>&#20351;&#29992;<CODE class=code>Desktop.enableServerPush(boolean 
  bool)</CODE>&#20026;&#26700;&#38754;&#35843;&#29992;&#21551;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#12290;</P>
  <LI>
  <P>&#23558;&#38656;&#35201;&#26356;&#26032;&#30340;&#32452;&#20214;&#20256;&#36882;&#33267;&#24037;&#20316;&#32447;&#31243;&#12290;</P>
  <LI>
  <P>&#22312;&#26700;&#38754;&#20869;&#35843;&#29992;&#24037;&#20316;&#32447;&#31243;&#12290;</P></LI></OL></DIV>
<P>[&#27880;]:&#20320;&#38656;&#35201;&#23433;&#35013;<CODE class=code>zkex.jar</CODE>&#25110;<CODE 
class=code>zkmax.jar</CODE>&#26469;&#20351;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#65292;&#38500;&#38750;&#20320;&#26377;&#33258;&#24049;<CODE 
class=code>org.zkoss.zk.ui.sys.ServerPush</CODE>&#30340;&#23454;&#29616;&#12290; </P>
<P>&#29616;&#22312;&#35753;&#25105;&#20204;&#26469;&#30475;&#19968;&#20010;&#23454;&#38469;&#30340;&#20363;&#23376;&#12290;&#33509;&#20320;&#24819;&#20351;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#26356;&#26032;&#23458;&#25143;&#31471;&#30340;&#25968;&#23383;&#65292;&#39318;&#20808;&#35201;&#20026;&#26700;&#38754;&#21551;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#65292;&#28982;&#21518;&#35843;&#29992;&#32447;&#31243; &#65292;&#22914;&#19979;&#12290;</P><PRE class=programlisting>&lt;window title="Demo of Server Push"&gt;
&lt;zscript&gt;
   import test.WorkingThread;
   WorkingThread thread;
   void startServerpush(){
      //enable server push
      desktop.enableServerPush(true);
         //invoke working thread and passing required component as parameter
         thread= new WorkingThread(info);
      thread.start();
   }
   void stopServerpush(){
      //stop the thread
      thread.setDone();
      //disable server push
      desktop.enableServerPush(false);
   }
&lt;/zscript&gt;
   &lt;vbox&gt;
      &lt;button label="Start Server Push" onClick="startServerpush()"/&gt;
      &lt;button label="Stop Server Push" onClick="stopServerpush()"/&gt;
   &lt;label id="info"/&gt;
   &lt;/vbox&gt;
&lt;/window&gt;
</PRE></DIV>
<DIV class=sect4 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H5 class=title><A name=id407050></A>&#23433;&#20840;&#38382;&#39064;</H5></DIV></DIV></DIV>
<P>&#38656;&#35201;&#27880;&#24847;&#30340;&#19968;&#20214;&#20107;&#26159;&#21516;&#27493;&#38382;&#39064;&#65292;&#21363;&#24403;&#22810;&#20010;&#32447;&#31243;&#35775;&#38382;&#21516;&#19968;&#26700;&#38754;&#26102;&#21457;&#29983;&#30340;&#38382;&#39064;&#12290;&#22240;&#27492;&#65292;&#22312;&#35775;&#38382;&#26700;&#38754;&#21069;&#65292;&#20320;&#24517;&#39035;&#35843;&#29992;<CODE 
class=code>Executions.activate(Desktop 
desktop)</CODE>&#26469;&#33719;&#21462;&#23545;&#26700;&#38754;&#30340;&#23436;&#20840;&#25511;&#21046;&#26435;&#65292;&#20197;&#36991;&#20813;&#36825;&#20010;&#38382;&#39064;&#65292;&#22312;&#32447;&#31243;&#23436;&#25104;&#23427;&#30340;&#24037;&#20316;&#21518;&#35843;&#29992;<CODE 
class=code>Executions.deactivate(Desktop desktop)</CODE>&#37322;&#25918;&#23545;&#26700;&#38754;&#30340;&#25511;&#21046;&#65292;&#22914;&#19979;&#65292;</P><PRE class=programlisting>package	test;

public	class	WorkingThread extends Thread{
   private final Desktop _desktop;
   private final Label _info;
   private int _cnt;
   private boolean _ceased;
   public	WorkingThread(Label info){
      _desktop = info.getDesktop();
      _info	= info;
   }
   public	void	run(){
      try	{
         while	(!_ceased){
            Threads.sleep(2000); //Update each two seconds
            Executions.activate(_desktop); //get full control of desktop
            try	{
               _info.setValue(Integer.toString(++_cnt));
            }catch	(RuntimeException ex)	{
               throw ex;
            }catch	(Error ex){
               throw ex;
            }finally{
              Executions.deactivate(_desktop);//release full control of	desktop
            }
         }
      }	catch(InterruptedException ex){
         }
   }
   public	void	setDone(){
      _ceased = true;
   }
}
</PRE></DIV>
<DIV class=sect4 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H5 class=title><A name=id407110></A>&#24149;&#21518;</H5></DIV></DIV></DIV>
<P>&#26381;&#21153;&#22120;&#25512;&#21160;&#26426;&#21046;&#26159;&#20351;&#29992;&#23458;&#25143;&#31471;&#36718;&#35810;(client-polling)&#25216;&#26415;&#23454;&#29616;&#30340;&#65292;&#21363;&#23458;&#25143;&#31471;&#23558;&#20250;&#21453;&#22797;&#35810;&#38382;&#26381;&#21153;&#22120;&#20197;&#35843;&#29992;&#24037;&#20316;&#32447;&#31243;&#23436;&#25104;&#20854;&#24037;&#20316;&#65292;&#35810;&#38382;&#30340;&#39057;&#29575;&#21487;&#20197;&#35843;&#29992;<CODE 
class=code>Executions.setDelay(int min, int max, int factor)</CODE>&#25163;&#21160;&#35843;&#25972;&#12290;</P>
<DIV class=orderedlist>
<OL type=1>
  <LI>
  <P>min&#65292;&#20026;&#20219;&#20309;&#23558;&#35201;&#21040;&#26469;&#30340;&#26381;&#21153;&#22120;&#25512;&#21160;&#36827;&#31243;&#33719;&#24471;(poll)&#26381;&#21153;&#22120;&#30340;&#26368;&#23567;&#24310;&#36831;&#12290;</P>
  <LI>
  <P>max&#65292;&#20026;&#20219;&#20309;&#23558;&#35201;&#21040;&#26469;&#30340;&#26381;&#21153;&#22120;&#25512;&#21160;&#36827;&#31243;&#33719;&#24471;(poll)&#26381;&#21153;&#22120;&#30340;&#26368;&#22823;&#24310;&#36831;&#12290;</P>
  <LI>
  <P>factor&#65292;&#23454;&#38469;&#30340;&#24310;&#36831;&#20026;&#22810;&#31181;&#24310;&#36831;&#22240;&#32032;&#22797;&#21512;&#30340;&#22788;&#29702;&#26102;&#38388;&#12290;</P></LI></OL></DIV>
<P>&#26368;&#21518;&#65292;&#38656;&#35201;&#27880;&#24847;&#30340;&#19968;&#20214;&#20107;&#26159;&#39057;&#29575;&#20250;&#20381;&#36182;&#26381;&#21153;&#22120;&#30340;&#21152;&#36733;&#32780;&#33258;&#21160;&#35843;&#25972;&#12290;</P></DIV>
<DIV class=sect3 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H4 class=title><A name=id407168></A>&#36873;&#25321; 2&#65306;&#32447;&#31243;&#25346;&#36215;&#21644;&#24674;&#22797;</H4></DIV></DIV></DIV>
<P>&#20351;&#29992;&#26381;&#21153;&#22120;&#25512;&#21160;&#25216;&#26415;&#65292;&#20320;&#19981;&#38656;&#35201;&#20851;&#24515;&#22810;&#32447;&#31243;&#30340;&#38382;&#39064;&#12290;&#20294;&#26159;&#65292;&#33509;&#20320;&#24819;&#33258;&#24049;&#22788;&#29702;&#36825;&#20010;&#24037;&#20316;&#65292;&#30001;&#20110;HTTP&#30340;&#38480;&#21046;&#24517;&#39035;&#36981;&#23432;&#22914;&#19979;&#30340;&#35268;&#21017;&#12290;</P></DIV>
<DIV class=orderedlist>
<OL type=1>
  <LI>
  <P>&#21019;&#24314;&#24037;&#20316;&#32447;&#31243;&#21518;&#65292;&#20351;&#29992;<CODE class=code>org.zkoss.zk.ui.Executions</CODE>&#31867;&#30340;<CODE 
  class=code>wait</CODE>&#26041;&#27861;&#26469;&#25346;&#36215;&#20107;&#20214;&#22788;&#29702;&#31243;&#24207;&#26412;&#36523;&#12290;</P>
  <LI>
  <P>&#30001;&#20110;&#24037;&#20316;&#32447;&#31243;&#19981;&#26159;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#65292;&#25152;&#20197;&#23427;&#19981;&#33021;&#35835;&#21462;&#20219;&#20309;&#32452;&#20214;&#65292;&#38500;&#38750;&#36825;&#20010;&#32452;&#20214;&#19981;&#23646;&#20110;&#20219;&#20309;&#26700;&#38754;&#12290;&#22240;&#27492;&#22312;&#24320;&#22987;&#24037;&#20316;&#32447;&#31243;&#20043;&#21069;&#20320;&#21487;&#33021;&#38656;&#35201;&#25163;&#21160;&#28155;&#21152;(pass)&#19968;&#20123;&#24517;&#35201;&#20449;&#24687;&#12290;</P>
  <LI>
  <P>&#28982;&#21518;&#65292;&#33509;&#26377;&#24517;&#35201;&#30340;&#35805;&#65292;&#24037;&#20316;&#32447;&#31243;&#21487;&#20197;&#21462;&#20986;&#20449;&#24687;&#65292;&#24182;&#19988;&#21019;&#24314;&#32452;&#20214;&#12290;&#21482;&#26159;&#19981;&#24341;&#29992;&#23646;&#20110;&#20219;&#20309;&#26700;&#38754;&#30340;&#20219;&#20309;&#32452;&#20214;&#12290;</P>
  <LI>
  <P>&#24037;&#20316;&#32447;&#31243;&#23436;&#25104;&#20043;&#21518;&#65292;&#22312;&#24037;&#20316;&#32447;&#31243;&#20013;&#20351;&#29992;<CODE class=code>org.zkoss.zk.ui.Executions</CODE>&#31867;&#20013;&#30340;<CODE 
  class=code>notify(Desktop desktop&#65292;Object flag)</CODE>&#25110; <CODE 
  class=code>notifyAll(Desktop desktop&#65292;Object flag)</CODE>&#26041;&#27861;&#26469;&#24674;&#22797;&#20107;&#20214;&#22788;&#29702;&#31243;&#24207;&#12290;</P>
  <LI>
  <P>&#30452;&#21040;&#21478;&#19968;&#20010;&#20107;&#20214;&#20174;&#23458;&#25143;&#31471;&#34987;&#21457;&#36865;&#36807;&#26469;&#65292;&#24674;&#22797;&#30340;&#20107;&#20214;&#22788;&#29702;&#31243;&#24207;&#25165;&#20250;&#25191;&#34892;&#12290;&#20026;&#20102;&#24378;&#21046;&#21457;&#36865;&#19968;&#20010;&#32452;&#20214;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;timer&#32452;&#20214;(<CODE 
  class=code>org.zkoss.zul.Timer</CODE>)&#35302;&#21457;&#20107;&#20214;&#29255;&#21051;&#20043;&#21518;&#25110;&#23450;&#26399;&#30340;&#12290;&#36825;&#20010;timer 
  &#30340;&#20107;&#20214;&#30417;&#21548;&#22120;&#21487;&#20197;&#19981;&#20570;&#20219;&#20309;&#20107;&#24773;&#25110;&#26356;&#25913;&#36827;&#23637;&#29366;&#20917;&#12290;</P></LI></OL></DIV>
<DIV class=sect4 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H5 class=title><A name=id407263></A>&#20107;&#20363;&#65306;&#19968;&#20010;&#24322;&#27493;&#20135;&#29983;&#26631;&#31614;&#30340;&#24037;&#20316;&#32447;&#31243;</H5></DIV></DIV></DIV>
<P>&#20551;&#23450;&#25105;&#20204;&#20197;&#24322;&#27493;&#30340;&#26041;&#24335;&#21019;&#24314;&#26631;&#31614;&#12290;&#24403;&#28982;&#65292;&#29992;&#22810;&#32447;&#31243;&#26469;&#20570;&#36825;&#20040;&#23567;&#30340;&#20107;&#26159;&#27809;&#26377;&#24847;&#20041;&#30340;&#65292;&#20294;&#26159;&#25105;&#20204;&#21487;&#20197;&#29992;&#26356;&#22797;&#26434;&#30340;(sophisticated)&#20219;&#21153;&#26469;&#20195;&#26367;&#36825;&#20010;&#12290;</P><PRE class=programlisting>//WorkingThread
package test;
public class WorkingThread extends Thread {
   private static int _cnt;

   private Desktop _desktop;
   private Label _label;
   private final Object _mutex = new Integer(0);

   /** Called by thread.zul to create a label asynchronously.
    * To create a label, it start a thread, and wait for its completion.
    */
   public static final Label asyncCreate(Desktop desktop)
   throws InterruptedException {
      final WorkingThread worker = new WorkingThread(desktop);
      synchronized (worker._mutex) { //to avoid racing
         worker.start();
         Executions.wait(worker._mutex);
         return worker._label;
      }
   }
   public WorkingThread(Desktop desktop) {
      _desktop = desktop;
   }
   public void run() {
      _label = new Label("Execute "+ ++_cnt);
      synchronized (_mutex) { //to avoid racing
         Executions.notify(_desktop, _mutex);
      }
   }
}
</PRE>
<P>&#28982;&#21518;&#65292;&#22312;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#20013;&#65292;&#25105;&#20204;&#20351;&#29992;ZUML&#39029;&#38754;&#26469;&#35843;&#29992;&#36825;&#20010;&#24037;&#20316;&#32447;&#31243;&#65292;&#22914;&#22312;<CODE class=code>onClick</CODE>&#20107;&#20214;&#20013;&#12290;</P><PRE class=programlisting>&lt;window id="main" title="Working Thread"&gt;
   &lt;button label="Start Working Thread"&gt;
   &lt;attribute name="onClick"&gt;
   timer.start();
   Label label = test.WorkingThread.asyncCreate(desktop);
   main.appendChild(label);
   timer.stop()
      &lt;/attribute&gt;
   &lt;/button&gt;
   &lt;timer id="timer" running="false" delay="1000" repeats="true"/&gt;
&lt;/window&gt;
</PRE>
<P>&#27880;&#24847;&#21040;&#25105;&#20204;&#24517;&#39035;&#20351;&#29992;timer&#26469;&#30495;&#27491;&#22320;&#24674;&#22797;&#34987;&#25346;&#36215;&#30340;&#20107;&#20214;&#30417;&#21548;&#22120;(<CODE 
class=code>onClick</CODE>)&#12290;&#36825;&#30475;&#36215;&#26469;&#26159;&#22810;&#20313;&#30340;&#65292;&#20294;&#26159;&#30001;&#20110;HTTP&#30340;&#38480;&#21046;&#65306;&#20026;&#20102;&#20445;&#25345;Web&#39029;&#38754;&#22312;&#27983;&#35272;&#22120;&#31471;&#30340;&#27963;&#36291;&#65292;&#24403;&#20107;&#20214;&#22788;&#29702;&#31243;&#24207;&#34987;&#25346;&#36215;&#26102;&#25105;&#20204;&#24517;&#39035;&#36820;&#22238;&#21709;&#24212;&#12290;&#28982;&#21518;&#65292;&#24037;&#20316;&#32447;&#31243;&#23436;&#25104;&#20102;&#24037;&#20316;&#24182;&#21796;&#37266;&#20102;&#20107;&#20214;&#30417;&#21548;&#22120;&#65292;HTTP&#35831;&#27714;&#24050;&#32463;&#19981;&#22312;&#20102;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#31181;&#26041;&#24335;&#26469;”&#25422;&#24102;(piggyback)”&#36825;&#20010;&#32467;&#26524;&#65292;&#32780;&#36825;&#23601;&#20351;timer&#20026;&#20160;&#20040;&#20250;&#34987;&#20351;&#29992;&#30340;&#21407;&#22240;&#12290;</P>
<P>&#26356;&#30830;&#20999;&#22320;&#35828;&#65292;&#24403;&#24037;&#20316;&#32447;&#31243;&#21796;&#37266;&#19968;&#20010;&#20107;&#20214;&#30417;&#21548;&#22120;&#26102;&#65292;ZK&#21482;&#26159;&#25226;&#23427;&#21152;&#21040;&#19968;&#20010;&#31561;&#24453;&#21015;&#34920;&#12290;&#24403;&#21478;&#19968;&#20010;HTTP&#35831; &#27714;&#21040;&#36798;&#26102;&#65292;&#30417;&#21548;&#22120;&#25165;&#30495;&#27491;&#24674;&#22797;(&#22914;&#19978;&#38754;&#20363;&#23376;&#20013;&#30340;<CODE 
class=code>onTimer</CODE>&#20107;&#20214;)&#12290;</P>
<P>&#22312;&#36825;&#20010;&#31616;&#21333;&#30340;&#20107;&#20363;&#20013;&#65292;&#25105;&#20204;&#24182;&#27809;&#26377;&#20026;<CODE 
class=code>onTimer</CODE>&#20107;&#20214;&#20316;&#20219;&#20309;&#20107;&#24773;&#12290;&#23545;&#20110;&#19968;&#20010;&#22797;&#26434;&#30340;&#24212;&#29992;&#31243;&#24207;&#65292;&#20320;&#21487;&#20197;&#29992;&#23427;&#26469;&#36820;&#22238;&#22788;&#29702;&#29366;&#24577;&#12290;</P></DIV>
<DIV class=sect3 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H4 class=title><A name=id407377></A>&#36873;&#25321; 3: Timer(&#27809;&#26377;&#25346;&#36215;/&#24674;&#22797;)</H4></DIV></DIV></DIV>
<P>&#26080;&#38656;&#25346;&#36215;&#21644;&#24674;&#22797;&#26469;&#23454;&#29616;&#19968;&#38271;&#25805;&#20316;(long operation)&#26159;&#30001;&#21487;&#33021;&#30340;&#12290;&#36825;&#22312;&#21516;&#27493;&#20195;&#30721;(synchronization 
codes)&#23545;&#20110;&#35843;&#35797;&#26469;&#35828;&#22826;&#22797;&#26434;&#30340;&#24773;&#20917;&#19979;&#26159;&#24456;&#26377;&#29992;&#30340;&#12290;</P>
<P>&#27880;&#24847;&#26159;&#24456;&#31616;&#21333;&#30340;&#12290;&#24037;&#20316;&#32447;&#31243;&#23558;&#32467;&#26524;&#20445;&#23384;&#22312;&#19968;&#20010;&#20020;&#26102;&#31354;&#38388;&#65292;&#28982;&#21518;&#20351;&#29992;<CODE 
class=code>onTimer</CODE>&#20107;&#20214;&#23558;&#32467;&#26524;&#24377;&#21040;(pops)&#26700;&#38754;&#12290;</P><PRE class=programlisting>//WorkingThread2
package test;
public class WorkingThread2 extends Thread {
   private static int _cnt;

   private final Desktop _desktop;
   private final List _result;

   public WorkingThread2(Desktop desktop, List result) {
      _desktop = desktop;
      _result = result;
   }   public void run() {
      _result.add(new Label("Execute "+ ++_cnt));
   }
}
</PRE>
<P>&#28982;&#21518;&#65292;&#22312;<CODE class=code>onTimer</CODE>&#20107;&#20214;&#30417;&#21548;&#22120;&#19978;&#38468;&#21152;&#26631;&#31614;&#12290;</P><PRE class=programlisting>&lt;window id="main" title="Working Thread2"&gt;
   &lt;zscript&gt;
   int numPending = 0;
   List result = Collections.synchronizedList(new LinkedList());
   &lt;/zscript&gt;
   &lt;button label="Start Working Thread"&gt;
      &lt;attribute name="onClick"&gt;
   ++numPending;   timer.start;
  new test.WorkingThread2(desktop, result).start();
      &lt;/attribute&gt;
   &lt;/button&gt;
   &lt;timer id="timer" running="false" delay="1000" repeats="true"&gt;
      &lt;attribute name="onTimer"&gt;
   while (!result.isEmpty()) {
      main.appendChild(result.remove(0));
      --numPending;
   }
   if (numPending == 0) timer.stop();
      &lt;/attribute&gt;
   &lt;/timer&gt;
&lt;/window&gt;</PRE></DIV>
<DIV class=sect3 lang=zh-CN>
<DIV class=titlepage>
<DIV>
<DIV>
<H4 class=title><A name=id407442></A>&#36873;&#25321; 
4&#65306;&#25422;&#24102;(piggyback)(&#27809;&#26377;&#25346;&#36215;/&#24674;&#22797;&#65292;&#27809;&#26377;Timer)</H4></DIV></DIV></DIV>
<P>&#24403;&#29992;&#25143;&#65292;&#20363;&#22914;&#65292;&#28857;&#20987;&#19968;&#20010;&#25353;&#38062;&#25110;&#36755;&#20837;&#19968;&#20123;&#19996;&#35199;&#26102;&#65292;&#20320;&#21487;&#20197;&#23558;&#32467;&#26524;&#25422;&#24102;(piggyback)&#21040;&#23458;&#25143;&#31471;&#65292;&#32780;&#19981;&#24517;&#24490;&#29615;&#22320;&#26816;&#26597;&#23427;&#20204;&#12290;</P>
<P>&#20026;&#20102;&#23436;&#25104;&#25422;&#24102;(piggyback)&#65292;&#20320;&#38656;&#35201;&#20026;&#19968;&#20010;&#26681;&#32452;&#20214;&#27880;&#20876;&#19968;&#20010;<CODE 
class=code>onPiggyback</CODE>&#20107;&#20214;&#30417;&#21548;&#22120;&#12290;&#28982;&#21518;&#27599;&#27425;ZK&#26356;&#26032;&#24341;&#25806;(ZK Update 
Engine)&#22788;&#29702;&#20107;&#20214;&#26102;&#65292;&#36825;&#20010;&#30417;&#21548;&#22120;&#23558;&#20250;&#34987;&#35843;&#29992;&#12290;&#20363;&#22914;&#65292;&#20320;&#21487;&#20197;&#25353;&#22914;&#19979;&#30340;&#26041;&#24335;&#37325;&#20889;&#20195;&#30721;&#12290;</P><PRE class=programlisting>&lt;window id="main" title="Working Thread3" onPiggyback="checkResult()"&gt;
   &lt;zscript&gt;
   List result = Collections.synchronizedList(new LinkedList());

   void checkResult() {
      while (!result.isEmpty())
         main.appendChild(result.remove(0));
   }
   &lt;/zscript&gt;
   &lt;button label="Start Working Thread"&gt;
      &lt;attribute name="onClick"&gt;
   timer.start();
   new test.WorkingThread2(desktop, result).start();
      &lt;/attribute&gt;
   &lt;/button&gt;
&lt;/window&gt;
</PRE>
<P>&#25422;&#24102;(piggyback)&#26041;&#24335;&#30340;&#20248;&#28857;&#26159;&#23458;&#25143;&#31471;&#19982;&#26381;&#21153;&#22120;&#31471;&#27809;&#26377;&#39069;&#22806;&#30340;&#24448;&#26469;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#20219;&#20309;&#27963;&#21160;(&#22914;&#28857;&#20987;&#25110;&#25171;&#23383;)&#30340;&#35805;&#26159;&#26080;&#27861;&#30475;&#21040;&#26356;&#26032;&#30340;&#12290;&#36825;&#31181;&#26041;&#24335;&#26159;&#21542;&#21512;&#36866;&#21462;&#20915;&#20110;&#24212;&#29992;&#31243;&#24207;&#30340;&#35201;&#27714;&#12290;</P>
<P>[&#27880;]: &#19968;&#20010;&#24310;&#26399;&#30340;&#20107;&#20214;(deferrable)&#19981;&#20250;&#39532;&#19978;&#34987;&#36865;&#21040;&#23458;&#25143;&#31471;&#65292;&#25152;&#20197;&#65292;&#21482;&#26377;&#19968;&#20010;&#38750;&#24310;&#26399;&#30340;&#20107;&#20214;&#34987;&#35302;&#21457;&#21518;<CODE 
class=code>onPiggyback</CODE>&#20107;&#20214;&#25165;&#20250;&#34987;&#35302;&#21457;&#12290;&#35831;&#21442;&#32771;&#20851;&#20110;&#24310;&#26399;&#20107;&#20214;&#30417;&#21548;&#22120;&#19968;&#33410;&#33719;&#24471;&#35814;&#32454;&#20449;&#24687;&#12290;</P></DIV></DIV></DIV>
<DIV class=navfooter>
<HR>

<CENTER>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-2627642070897863";
/* docs-page-728x90, 08-9-16 */
google_ad_slot = "5345955928";
google_ad_width = 728;
google_ad_height = 90;
//-->
</SCRIPT>

<SCRIPT src="&#32447;&#31243;(Thread)&#27169;&#22411;.files/show_ads.js" type=text/javascript> 
</SCRIPT>
</CENTER>
<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD align=left width="40%"><A accessKey=p 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05s03.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD align=middle width="20%"><A accessKey=u 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05.html">&#19978;&#19968;&#32423;</A></TD>
    <TD align=right width="40%">&nbsp;<A accessKey=n 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/ch05s05.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top align=left width="40%">&#20107;&#20214;&#30417;&#21548;&#22120;&#25552;&#20132;,&#21457;&#36865;&#21644;&#22238;&#26174;&#20107;&#20214;&nbsp;</TD>
    <TD align=middle width="20%"><A accessKey=h 
      href="http://docs.huihoo.com/zk/3.5.1/devguide-zh/index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top align=right 
width="40%">&nbsp;&#21021;&#22987;&#19982;&#28165;&#29702;&#20107;&#20214;&#22788;&#29702;&#32447;&#31243;</TD></TR></TBODY></TABLE></DIV></BODY></HTML>
